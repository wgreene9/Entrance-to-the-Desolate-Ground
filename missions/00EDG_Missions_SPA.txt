EDG_FOI_SPA_main_mission_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_SPA_generic_mission_tag_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}

	FOI_SPA_1_3 = { #伊比利亚之火
		icon = mission_modern_knight_army
		position = 1
		provinces_to_highlight = {
			owner = {
				war_with = root
			}
		}
		trigger = {
			is_at_war = yes
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_1_3 }
			EDG_FOI_attack_ask_for_help_effect = { who = root }
			every_country = {
				limit = {
					capital_scope = {
						region = iberia_region
						religion_group = christian
					}
				}
				1566 = {
					discover_country = prev
				}
				1567 = {
					discover_country = prev
				}
			}
		}
	}
	FOI_SPA_2_3 = { #稳定北方
		icon = mission_industria_sedera
		position = 2
		required_missions = {
			"FOI_SPA_1_3"
		}
		provinces_to_highlight = {
			OR = {
				area = basque_country
				area = asturias_area
			}
			OR = {
				NOT = {
					country_or_non_sovereign_subject_holds = root
				}
				owner = {
					NOT = {
						has_opinion = {
							who = root
							value = 75
						}
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 210
				province_2 = 207
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_2_3 }
			define_advisor = {
				type = treasurer
				skill = 2
				cost_multiplier = 0.25
				culture = root
			}
			basque_country = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			asturias_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					207 = {
						country_or_non_sovereign_subject_holds = root
					}
					210 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.2
				}
			}
		}
	}
	FOI_SPA_3_3 = { #伊比利亚雄心
		icon = conquer_burgundy
		position = 3
		required_missions = {
			"FOI_SPA_2_3"
		}
		provinces_to_highlight = {
			OR = {
				area = leon_area
				area = castille_area
			}
			NOT = {
				OR = {
					country_or_non_sovereign_subject_holds = root
					owner = {
						has_opinion = {
							who = root
							value = 75
						}
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 217
				province_2 = 208
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_3_3 }
			add_country_modifier = {
				name = EDG_modifier_SPA_mission_1
				duration = 7300
			}
			castille_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			leon_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					217 = {
						country_or_non_sovereign_subject_holds = root
					}
					208 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.0
				}
			}
		}
	}
	FOI_SPA_4_3 = { #向南推进！
		icon = mission_expel_the_moriscos
		position = 4
		required_missions = {
			"FOI_SPA_3_3"
		}
		provinces_to_highlight = {
			OR = {
				area = extremadura_area
				area = toledo_area
			}
			NOT = {
				OR = {
					country_or_non_sovereign_subject_holds = root
					owner = {
						has_opinion = {
							who = root
							value = 75
						}
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 219
				province_2 = 218
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_4_3 }
			extremadura_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			toledo_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					218 = {
						country_or_non_sovereign_subject_holds = root
					}
					219 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.10
				}
			}
		}
	}
	FOI_SPA_5_3 = { #纯净伊比利亚
		icon = mission_rb_control_the_hansa
		position = 5
		required_missions = {
			"FOI_SPA_4_3"
			"FOI_SPA_4_2"
			"FOI_SPA_4_4"
		}
		provinces_to_highlight = {
			owner = {
				capital_scope = {
					region = iberia_region
				}
				NOT = {
					religion_group = root
				}
			}
		}
		trigger = {
			is_at_war = no
			has_any_disaster = no
			is_subject = no
			all_country = {
				OR = {
					capital_scope = {
						NOT = {
							region = iberia_region
						}
					}
					AND = {
						capital_scope = {
							region = iberia_region
						}
						NOT = {
							tag = root
						}
						NOT = {
							total_development = root
						}
					}
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_5_3  }
			EDG_FOI_add_victory_point = yes
			country_event = {
				id = FOIMissionEvents.8
			}
			hidden_effect = {
				set_global_flag = FOI_last_battle_flag
			}
			iberia_region = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			add_country_modifier = {
				name = "EDG_adm_policy_2_modifier"
				duration = 9125
			}
			add_country_modifier = {
				name = "EDG_modifier_union_kingdom"
				duration = -1
			}
			define_advisor = {
				type = bailiff
				skill = 3
				cost_multiplier = 0.25
				culture = ROOT
			}
			swap_non_generic_missions = yes
		}
	}
}
EDG_FOI_SPA_main_mission_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_SPA_generic_mission_tag_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}

	FOI_SPA_2_1 = { #西部战略
		icon = mission_battle_of_varna
		position = 2
		required_missions = {
			"FOI_SPA_1_3"
		}
		provinces_to_highlight = {
			OR = {
				area = galicia_area
				area = beieras_area
			}
			OR = {
				NOT = {
					country_or_non_sovereign_subject_holds = root
				}
				owner = {
					NOT = {
						has_opinion = {
							who = root
							value = 75
						}
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 206
				province_2 = 231
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_2_1  }
			add_country_modifier = {
				name = EDG_modifier_SPA_mission_1_1
				duration = 7300
			}
			galicia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			beieras_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			add_army_tradition = 10
			if = {
				limit = { 
					231 = {
						country_or_non_sovereign_subject_holds = root
					}
					206 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.1
				}
			}
		}
	}
	FOI_SPA_3_1 = { #统一西部
		icon = mission_develop_nevas_port
		position = 3
		provinces_to_highlight = {
			area = alentejo_area
			NOT = {
				country_or_non_sovereign_subject_holds = root
			}
		}
		required_missions = {
			"FOI_SPA_2_1"
		}
		trigger = {
			all_owned_province = {
				is_core = root
			}
			is_at_war = no
			is_subject = no
			227 = {
				OR = {
					country_or_non_sovereign_subject_holds = root
					owner = {
						has_spy_network_from = {
							who = root
							value = 20
						}
					}
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_3_1  }
			EDG_FOI_add_victory_point = yes
			add_country_modifier = {
				name = EDG_modifier_SPA_mission_1_12
				duration = 7300
			}
			add_army_tradition = 10
			alentejo_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					227 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				add_prestige_or_monarch_power = { amount = 10 }
			}
			else = {
				country_event = {
					id = FOIMissionEvents.4
				}
			}
		}
	}
}
EDG_FOI_SPA_main_mission_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_SPA_generic_mission_tag_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}

	FOI_SPA_2_2 = { #团结内部
		icon = spa_spanish_road
		position = 2
		required_missions = {
			"FOI_SPA_1_3"
		}
		provinces_to_highlight = {
			region = iberia_region
			owner = {
				NOT = {
					OR = {
						alliance_with = root
						has_opinion = {
							who = root
							value = 100
						}
					}
				}
				religion_group = root
			}
		}
		trigger = {
			OR = {
				is_year = 1454
				calc_true_if = {
					all_ally = {
						religion_group = root
						has_opinion = {
							who = root
							value = 100
						}
						capital_scope = {
							region = iberia_region
						}
					}
					amount = 1
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_2_2 }
			EDG_FOI_add_victory_point = yes
			custom_tooltip = FOI_SPA_2_2.tt
			hidden_effect = {
				every_country = {
					limit = {
						religion_group = root
						has_opinion = {
							who = root
							value = 100
						}
						capital_scope = {
							region = iberia_region
						}
					}
					root = {
						add_adm_power = 50
						add_dip_power = 50
						add_mil_power = 50
					}
				}
			}
			add_country_modifier = {
				name = EDG_FOI_pragmatic_diplomacy
				duration = 3650
			}
		}
	}
	FOI_SPA_4_2 = { #进军[225.GetName]
		icon = mission_crush_eyalet_rebellion
		position = 4
		required_missions = {
			"FOI_SPA_2_2"
			"FOI_SPA_3_1"
		}
		provinces_to_highlight = {
			area = lower_andalucia_area
			NOT = {
				country_or_non_sovereign_subject_holds = root
			}
		}
		trigger = {
			all_owned_province = {
				is_core = root
			}
			is_at_war = no
			is_subject = no
			225 = {
				OR = {
					country_or_non_sovereign_subject_holds = root
					owner = {
						has_spy_network_from = {
							who = root
							value = 20
						}
					}
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_4_2  }
			lower_andalucia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					225 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.6
				}
			}
		}
	}
}
EDG_FOI_SPA_main_mission_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_SPA_generic_mission_tag_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}

	FOI_SPA_2_4 = { #拉拢外部
		icon = mission_mansure_army
		position = 2
		required_missions = {
			"FOI_SPA_1_3"
		}
		provinces_to_highlight = {
			NOT = {
				region = iberia_region
			}
			owner = {
				religion_group = root
				NOT = {
					OR = {
						alliance_with = root
						has_opinion = {
							who = root
							value = 100
						}
					}
				}
				total_development = 75
			}
		}
		trigger = {
			OR = {
				is_year = 1454
				calc_true_if = {
					all_ally = {
						religion_group = root
						has_opinion = {
							who = root
							value = 100
						}
						total_development = 75
						capital_scope = {
							NOT = {
								region = iberia_region
							}
						}
					}
					amount = 1
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_2_4 }
			EDG_FOI_add_victory_point = yes
			#£adm£
			custom_tooltip = FOI_SPA_2_4.tt
			hidden_effect = {
				every_country = {
					limit = {
						has_opinion = {
							who = root
							value = 100
						}
						total_development = 100
						capital_scope = {
							NOT = {
								region = iberia_region
							}
						}
					}
					root = {
						add_yearly_manpower = 0.5
						add_years_of_income = 0.5
					}
				}
			}
			add_country_modifier = {
				name = EDG_FOI_pragmatic_diplomacy
				duration = 3650
			}
		}
	}
	FOI_SPA_4_4 = { #挺近[223.GetName]
		icon = mission_fall_of_constantinople
		position = 4
		required_missions = {
			"FOI_SPA_2_4"
			"FOI_SPA_3_5"
		}
		provinces_to_highlight = {
			area = upper_andalucia_area
			NOT = {
				country_or_non_sovereign_subject_holds = root
			}
		}
		trigger = {
			all_owned_province = {
				is_core = root
			}
			is_at_war = no
			is_subject = no
			223 = {
				OR = {
					country_or_non_sovereign_subject_holds = root
					owner = {
						has_spy_network_from = {
							who = root
							value = 20
						}
					}
				}
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_4_4  }
			upper_andalucia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					223 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.7
				}
			}
		}
	}
}
EDG_FOI_SPA_main_mission_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_SPA_generic_mission_tag_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}

	FOI_SPA_2_5 = { #东部战略
		icon = fra_peninsular_war
		position = 2
		required_missions = {
			"FOI_SPA_1_3"
		}
		provinces_to_highlight = {
			OR = {
				area = aragon_area
				area = catalonia_area
			}
			OR = {
				NOT = {
					country_or_non_sovereign_subject_holds = root
				}
				owner = {
					NOT = {
						has_opinion = {
							who = root
							value = 75
						}
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 214
				province_2 = 213
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = { mission = FOI_SPA_2_5  }
			add_country_modifier = {
				name = EDG_modifier_SPA_mission_1_4
				duration = 7300
			}
			aragon_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			catalonia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			add_prestige_or_monarch_power = { amount = 20 } 
			if = {
				limit = { 
					213 = {
						country_or_non_sovereign_subject_holds = root
					}
					214 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				EDG_FOI_add_victory_point = yes
			}
			else = {
				country_event = {
					id = FOIMissionEvents.3
				}
			}
			
		}
	}
	FOI_SPA_3_5 = { #统一东部
		icon = mission_beyond_the_urals
		position = 3
		required_missions = {
			"FOI_SPA_2_5"
		}
		provinces_to_highlight = {
			OR = {
				area = baleares_area
				area = valencia_area
			}
			OR = {
				NOT = {
					country_or_non_sovereign_subject_holds = root
				}
				owner = {
					has_opinion = {
						who = root
						value = 75
					}
				}
			}
		}
		trigger = {
			EDG_FOI_conquer_mission_common_trigger = {
				province_1 = 220
				province_2 = 333
			}
		}
		effect = {
			EDG_FOI_SPA_complete_especial_mission = {  mission = FOI_SPA_3_5  }
			EDG_FOI_add_victory_point = yes
			add_country_modifier = {
				name = EDG_modifier_SPA_mission_4_12
				duration = 7300
			}
			add_prestige_or_monarch_power = { amount = 10 } 
			add_army_tradition = 10
			baleares_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			valencia_area = {
				limit = {
					NOT = { is_permanent_claim = ROOT } 
					NOT = { is_core = ROOT } 
				}
				add_permanent_claim = ROOT
			}
			if = {
				limit = { 
					333 = {
						country_or_non_sovereign_subject_holds = root
					}
					220 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				add_prestige_or_monarch_power = { amount = 10 }
			}
			else = {
				country_event = {
					id = FOIMissionEvents.5
				}
			}
		}
	}
}

##################FOI REBUILD MISSION##################
EDG_FOI_SPA_rebuild_mission_3 = {
    slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_rebuild_mission_common_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}
    FOI_SPA_6_3 = { #重建工作
        icon = mission_colonial
        position = 6
        provinces_to_highlight = {
            country_or_non_sovereign_subject_holds = root
            region = iberia_region
        }
		required_missions = {
			"FOI_SPA_5_3"
		}
        trigger = {
            custom_trigger_tooltip = {
                tooltip = FOI_iberian_strife_already_end
                has_global_flag = IBR_conflict_end_flag
            }
			OR = {
				custom_trigger_tooltip = {
					tooltip = FOI_FOI_unify_iberia_country
					has_country_flag = FOI_unify_iberia_country_flag
				}
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					region = iberia_region
					value = 55
				}
			}
			if = {
				limit = { 
					tag = CAT
				}
				custom_trigger_tooltip = {
					tooltip = FOI_SPA_6_3.cat.tt
					NOT = {
						has_global_flag = FOI_UCI_modifier_enemy_flag
					}
				}
			}
        }
        effect = {
			country_event  ={
				id = FOIMissionEvents.23
			}
			custom_tooltip = FOI_enable_infrastructure_building
			hidden_effect = {
                set_country_flag = FOI_enable_infrastructure_building_flag
            }
			add_country_modifier = {
				name = EDG_FOI_iberian_integration
				duration = -1
			}
			add_country_modifier = {
				name = EDG_FOI_iberia_rehabilitate
				duration = -1
			}
            iberia_region = {
                limit = {
                    country_or_non_sovereign_subject_holds = root
                }
                add_province_modifier = {
                    name = EDG_FOI_reconstruction_work
                    duration = 1825
                }
            }
            add_ruler_personality = architectural_visionary_personality
            add_government_reform = EDG_FOI_national_reconstruction_bureau
            add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 5
            }
			if = {
				limit = { 
					217 = {
						NOT = {
							owned_by = root
						}
					}
				}
				217 = {
					add_core = root
					cede_province = root
					
				}
			}
			if = {
				limit = { 
					217 = {
						NOT = {
							is_capital_of = root
						}
					}
				}
				set_capital = 217
			}
			capital_scope = {
				add_province_modifier = {
					name = EDG_FOI_iberia_infrastructure_capital
					duration = -1
				}
				hidden_effect = {
					every_neighbor_province = {
						set_province_flag = EDG_FOI_iberia_infrastructure_building_flag
					}
				}
			}
        }
    }
    FOI_SPA_7_3 = { #伊比利亚基建法案
        icon = mission_envoy_to_ethiopia
        position = 7
        required_missions = { "FOI_SPA_6_3" } 
        provinces_to_highlight = { province_id = 217 } 

        trigger = {
            if = {
				limit = { 
					ai = no
				}
				217 = {
					owned_by = root
					development = 25
					has_tax_building_trigger = yes
					has_trade_building_trigger = yes
					has_fort_building_trigger = yes
				}
			}
			else = {
				always = yes
			}
        }
        effect = {
			add_adm_power = 500
			add_dip_power = 500
			add_mil_power = 500
            add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 1
            }
            set_great_project_tier_2 = { type = EDG_OrientalPalace }
			hidden_effect = {
				add_adm_tech = 1
				add_dip_tech = 1
				add_mil_tech = 1
			}
        }
    }
    FOI_SPA_8_3 = { #科尔多瓦大教堂
		icon = mission_danish_kingdom
		position = 8
		required_missions = { "FOI_SPA_7_3" } 
		provinces_to_highlight = { province_id = 225 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					225 = {
						AND = {
							country_or_non_sovereign_subject_holds = root
							base_tax = 8
							base_production = 8
							base_manpower = 8
							has_tax_building_trigger = yes
							has_trade_building_trigger = yes
						}
					}
					NOT = {
						country_or_non_sovereign_subject_holds = root
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			add_country_modifier = {
				name = "EDG_Religious_piety_modifier"
				duration = 9125
			}
			225 = {
				add_province_modifier = {
					name = "EDG_City_Tax_bloom"
					duration = -1
				}
				set_great_project_tier_1 = { type = EDG_Cordoba_cathedral }

			}
		}
	}
    FOI_SPA_9_3 = { #发掘[2754.GetName]金矿
		icon = mission_war_chest
		position = 9
		required_missions = { 
            FOI_SPA_8_3 
        } 
		provinces_to_highlight = { province_id = 2754 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					2754 = {
						AND = {
							country_or_non_sovereign_subject_holds = root
							base_production = 10
							has_tax_building_trigger = yes
							has_trade_building_trigger = yes
						}
					}
					NOT = {
						2754 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					2754 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				add_years_of_income = 2.0
				add_country_modifier = {
					name = "EDG_produce_upgrade_1_modifier"
					duration = 9125
				}
				2754 = {
					add_province_modifier = {
						name = "EDG_City_trade_goods_size_bloom"
						duration = -1
					}
				}
				define_advisor = {
					type = natural_scientist
					skill = 3
					cost_multiplier = 0.25
					culture = ROOT
				}
			}
		}
	}
	FOI_SPA_10_3 = { #民族认同
		icon = spa_tercios_system
		position = 9
		required_missions = {
			"FOI_SPA_9_3"
		}
		provinces_to_highlight = {
			region = iberia_region
			owned_by = root
			OR = {
				NOT = {
					OR = {
						has_owner_accepted_culture = yes
						has_owner_culture = yes
					}
				}
				unrest = 5
			}
		}

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				iberia_region = {
					type = all
					OR = {
						AND = {
							OR = {
								has_owner_accepted_culture = yes
								has_owner_culture = yes
							}
							NOT = {
								unrest = 5
							}
							owned_by = root
						}
						NOT = {
							owned_by = root
						}
					}
				}
			}
			else = {
				iberia_region = {
					type = all
					OR = {
						AND = {
							NOT = {
								unrest = 5
							}
							owned_by = root
						}
						NOT = {
							owned_by = root
						}
					}
				}
			}
		}

		effect = {
			add_dip_power = 250
			custom_tooltip = FOI_SPA_10_3.tt
			remove_country_modifier = EDG_FOI_iberian_integration
			add_country_modifier = {
				name = EDG_FOI_cultural_identity
				duration = -1
			}
			add_accepted_culture = EDG_iberians
			hidden_effect  = {
				country_event = {
					id = FOIMissionEvents.500
				}
			}
		}
	}
	FOI_SPA_11_3 = { #伊比利亚新生
		icon = mission_plus_ultra
		required_missions = {
			"FOI_SPA_10_3"
			"FOI_SPA_10_2"
			"FOI_SPA_10_4"
		}
		provinces_to_highlight = {
			region = iberia_region
			country_or_non_sovereign_subject_holds = root
		}

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				is_at_war = no
				has_any_disaster = no
				has_government_power = {
					mechanic_type = FOI_iberia_reconstruction_work_mechanic
					power_type = FOI_iberia_reconstruction_work
					value = 100
				}
			}
			else = {
				has_country_flag = EDG_FOI_end_iberia_great_famine_flag
			}
		}

		effect = {
			country_event ={
				id = FOIMissionEvents.24
			}
		}
	}
}
EDG_FOI_SPA_rebuild_mission_1 = {
    slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_rebuild_mission_common_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}
    FOI_SPA_7_1 = { #资金问题
        icon = mission_african_gold
        position = 7
        required_missions = {
            "FOI_SPA_6_3"
        }
        provinces_to_highlight = {
            is_capital_of = root
        }
        trigger = {
			if = {
				limit = { 
					ai = no
				}
				stability = 1
				is_bankrupt = no
				has_government_power = {
					mechanic_type = FOI_iberia_reconstruction_work_mechanic
					power_type = FOI_iberia_reconstruction_work
					value = 5
				}
			}
			else = {
				always = yes
			}
        }
        effect = {
            add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = -5
            }
            for = {
                custom_tooltip = FOI_SPA_get_ten_loan
                amount = 10
                effect = "
                    add_loan = {
                        fixed_interest = 1
                        duration = 60
                        estate_loan = yes
                        interest_modifier = 0
                    }
                "
            }
        }
    }
    FOI_SPA_8_1 = { #里斯本港
		icon = mission_combat_barbary_piracy
		position = 8
		required_missions = {  
            "FOI_SPA_7_1" 
        } 
		provinces_to_highlight = { province_id = 227 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					227 = {
						AND = {
							country_or_non_sovereign_subject_holds = root
							has_trade_building_trigger = yes
							has_tax_building_trigger = yes
							development = 25
						}
					}
					NOT = {
						227 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					227 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				227 = {
					add_province_modifier = {
						name = "EDG_City_Trade_1_modifier"
						duration = -1
					}
					set_great_project_tier_2 = { type = EDG_Lisbon_Cathedral }
				}
			}
		}
	}
}
EDG_FOI_SPA_rebuild_mission_2 = {
    slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_rebuild_mission_common_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}
    FOI_SPA_8_2 = { #巴伦西亚港
		icon = mission_valencian_silk
		position = 8
		required_missions = { FOI_SPA_7_1 } 
		provinces_to_highlight = { province_id = 220 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					220 = {
						country_or_non_sovereign_subject_holds = root
						development = 20
						has_dock_building_trigger = yes
						has_trade_building_trigger = yes
					}
					NOT = {
						220 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					220 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				220 = {
					add_province_modifier = {
						name = "EDG_City_develop_attractions"
						duration = -1
					}
					set_great_project_tier_3 = { type = EDG_Valencia_Catedral } 
					change_trade_goods = silk
					add_province_modifier = {
						name = "llotja_de_la_seda"
						duration = -1
					}
					if = {
						limit = { 
							NOT = {
								has_building = shipyard
							}
						}
						add_building = shipyard
					}
					else = {
					   add_building = grand_shipyard
					}
				}
				add_country_modifier = {
					name = "EDG_SPA_3_16_develop"
					duration = -1
				}
			}
		}
	}
    FOI_SPA_9_2 = { #巴塞罗那港 
        icon = mission_guilds_of_barcelona
        position = 9
        required_missions = { 
			"FOI_SPA_8_2" 
			"FOI_SPA_8_1"
		} 
        provinces_to_highlight = { province_id = 213 } 

        trigger = {
            if = {
				limit = { 
					ai = no
				}
				OR = {
					213 = {
						AND = {
							country_or_non_sovereign_subject_holds = root
							development = 20
							has_dock_building_trigger = yes
							has_trade_building_trigger = yes
						}
					}
					NOT = {
						213 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
        }

        effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					213 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				213 = {
					add_base_production = 3
					add_province_modifier = {
						name = barcelona_guilds
						duration = -1
					}
					if = {
						limit = { 
							NOT = {
								has_building = shipyard
							}
						}
						add_building = shipyard
					}
					else = {
					   add_building = grand_shipyard
					}
				}
			}
        }
    }
	FOI_SPA_10_2 = { #兴建教堂
		icon = mission_claim_hispaniola
		position = 10
		required_missions = {
			"FOI_SPA_9_2"
		}

		provinces_to_highlight = {
			region = iberia_region
			country_or_non_sovereign_subject_holds = root
			NOT = {
				has_tax_building_trigger = yes
			}
		}

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					region = iberia_region
					value = 35
					has_tax_building_trigger = yes
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			iberia_region = {
				limit = {
					country_or_non_sovereign_subject_holds = root
				}
				add_province_triggered_modifier = EDG_FOI_pious_place
			}
		}
	}
}
EDG_FOI_SPA_rebuild_mission_4 = {
    slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_rebuild_mission_common_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}
    FOI_SPA_8_4 = { #马林港
		icon = mission_conquer_arakan
		position = 8
		required_missions = { 
            "FOI_SPA_7_5" 
        } 
		provinces_to_highlight = { province_id = 206 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					206 = {
						AND = {
							country_or_non_sovereign_subject_holds = root
							development = 20
							has_dock_building_trigger = yes
							has_trade_building_trigger = yes
						}
					}
					NOT = {
						206 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
            add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					206 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				206 = {
					add_province_modifier = {
						name = "EDG_City_Trade_1_modifier"
						duration = -1
					}
					set_great_project_tier_3 = { type = EDG_GaliciaPalace }
					if = {
						limit = { 
							NOT = {
								has_building = shipyard
							}
						}
						add_building = shipyard
					}
					else = {
					   add_building = grand_shipyard
					}
				}
				add_country_modifier = {
					name = "EDG_SPA_3_14_develop_modifier"
					duration = 7300
				}
			}
		}
	}
    FOI_SPA_9_4 = { #塞维利亚港
		icon = adriatic_access
		position = 9
        required_missions = {
            "EDG_SPA_8_5"
			"FOI_SPA_8_4"
        }
		provinces_to_highlight = { province_id = 224 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					224 = { 
						country_or_non_sovereign_subject_holds = root
						has_trade_building_trigger = yes
						has_dock_building_trigger = yes
						development = 25
						is_strongest_trade_power = root
					}
					NOT = {
						224 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					224 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				set_country_flag = sevilla_trade_center_flag
				country_event = { id = flavor_spa.3153 } 
				224 = { 
					upgrade_building = { trade = yes } 
					if = {
						limit = { 
							NOT = {
								has_building = shipyard
							}
						}
						add_building = shipyard
					}
					else = {
					add_building = grand_shipyard
					}
				} 
			}
		}
	}
	FOI_SPA_10_4 = { #贸易体系
		icon = mission_dominate_genoa
		position = 10
		required_missions = {
			"FOI_SPA_9_4"
		}

		provinces_to_highlight = {
			region = iberia_region
			country_or_non_sovereign_subject_holds = root
			NOT = {
				has_trade_building_trigger = yes
			}
		}

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					region = iberia_region
					value = 10
					has_trade_building_trigger = yes
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			iberia_region = {
				limit = {
					country_or_non_sovereign_subject_holds = root
				}
				add_province_triggered_modifier = EDG_FOI_the_iberian_bazaar
			}
		}
	}
}
EDG_FOI_SPA_rebuild_mission_5 = {
    slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		EDG_FOI_rebuild_mission_common_trigger = yes
		NOT = { map_setup = map_setup_random } 
	}
    FOI_SPA_7_5 = { #稳定问题
        icon = mission_restore_faith_in_the_throne
        position = 7
		required_missions = {
			"FOI_SPA_6_3"
		}
        provinces_to_highlight = {
            is_capital_of = root
        }
        trigger = {
			if = {
				limit = { 
					ai = no
				}
				is_bankrupt = no
				has_government_power = {
					mechanic_type = FOI_iberia_reconstruction_work_mechanic
					power_type = FOI_iberia_reconstruction_work
					value = 5
				}
			}
			else = {
				always = yes
			}
        }
        effect = {
            add_stability_or_adm_power_per_stab = {
                amount = 3
            }
            add_corruption = -3
            add_inflation = -5
            add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = -5
            }
        }
    }
    EDG_SPA_8_5 = { #希洪港
		icon = mission_seize_the_bengal_coast
		position = 8
		required_missions = { 
            "FOI_SPA_7_5" 
        } 
		provinces_to_highlight = { province_id = 207 } 

		trigger = {
			if = {
				limit = { 
					ai = no
				}
				OR = {
					207 = {
						country_or_non_sovereign_subject_holds = root
						development = 20
						has_dock_building_trigger = yes
						has_trade_building_trigger = yes
					}
					NOT = {
						207 = {
							country_or_non_sovereign_subject_holds = root
						}
					}
				}
			}
			else = {
				always = yes
			}
		}

		effect = {
			add_government_power = {
                mechanic_type = FOI_iberia_reconstruction_work_mechanic
                power_type = FOI_iberia_reconstruction_work
                value = 3
            }
			if = {
				limit = { 
					207 = {
						country_or_non_sovereign_subject_holds = root
					}
				}
				207 = {
					add_province_modifier = {
						name = "EDG_City_develop_build_and_product_modifier"
						duration = -1
					}
					set_great_project_tier_3 = { type = EDG_OviedoPalace } 
				}
				add_country_modifier = {
					name = "EDG_SPA_3_15_develop"
					duration = 7300
				}
			}
		}
	}
}
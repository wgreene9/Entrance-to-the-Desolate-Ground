namespace = ambrosian_republic
country_event = {
  id = ambrosian_republic.1
  title = ambrosian_republic.1.t
  desc = {
    trigger = {
      has_reform = EDG_Ambrose_Philosopher_Council
      is_subject = no
    }
    desc = ambrosian_republic.1.d
  }
  desc = {
    trigger = {
      has_reform = EDG_Military_Dictatorship_Philosopher_Council
      is_subject = no
    }
    desc = ambrosian_republic.1.d2
  }
  desc = {
    trigger = {
      government = monarchy
      is_subject = no
    }
    desc = ambrosian_republic.1.d3
  }
  desc = {
    trigger = {
      is_subject = yes
    }
    desc = ambrosian_republic.1.d4
  }
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  immediate = {
    hidden_effect = {
      set_country_flag = ambrosian_republic_completely_resolved
      set_country_flag = ambrosian_republic_resolved
    }
  }
  option = {
    name = ambrosian_republic.1.a
    add_stability_or_adm_power = yes
    add_prestige = 20
    add_country_modifier = {
      name = mlo_secure_state
      duration = 7300
    }
    if = {
      limit = {
        any_country = {
          has_casus_belli = {
            type = cb_restore_personal_union
            target = root
          }
        }
      }
      custom_tooltip = emp_mlo_secure_rule_effect_tooltip
      hidden_effect = {
        every_country = {
          limit = {
            has_casus_belli = {
              type = cb_restore_personal_union
              target = root
            }
          }
          remove_casus_belli = {
            type = cb_restore_personal_union
            target = root
          }
        }
      }
    }
  }
}
country_event = {
  id = ambrosian_republic.2
  title = ambrosian_republic.2.t
  desc = ambrosian_republic.2.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  trigger = {
    had_country_flag = {
      flag = had_ambrosian_republic
      days = 365
    }
    has_reform = EDG_Ambrose_Philosopher_Council
    exists = FRA
    FRA = {
      is_subject = no
      government = monarchy
    }
    hre_size = 1
    emperor = {
      government = monarchy
    }
  }
  option = {
    name = ambrosian_republic.2.a
    FRA = {
      country_event = {
        id = ambrosian_republic.3
      }
    }
    emperor = {
      country_event = {
        id = ambrosian_republic.4
      }
    }
  }
}
country_event = {
  id = ambrosian_republic.3
  title = ambrosian_republic.2.t
  desc = ambrosian_republic.3.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  option = {
    name = ambrosian_republic.3.a
    ai_chance = {
      factor = 75
    }
    add_casus_belli = {
      type = cb_restore_personal_union
      months = 300
      target = MLO
    }
  }
  option = {
    name = ambrosian_republic.3.b
    ai_chance = {
      factor = 25
    }
    add_prestige = 5
  }
}
country_event = {
  id = ambrosian_republic.4
  title = ambrosian_republic.2.t
  desc = ambrosian_republic.4.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  option = {
    name = ambrosian_republic.3.a
    ai_chance = {
      factor = 75
    }
    add_casus_belli = {
      type = cb_restore_personal_union
      months = 300
      target = MLO
    }
  }
  option = {
    name = ambrosian_republic.3.b
    ai_chance = {
      factor = 25
    }
    add_prestige = 5
  }
}
country_event = {
  id = ambrosian_republic.5
  title = ambrosian_republic.5.t
  desc = {
    trigger = {
      war_with = VEN
    }
    desc = ambrosian_republic.5.d
  }
  desc = {
    trigger = {
      is_at_war = yes
      NOT = {
        war_with = VEN
      }
    }
    desc = ambrosian_republic.5.d2
  }
  desc = {
    trigger = {
      num_of_rebel_armies = 1
      is_at_war = no
    }
    desc = ambrosian_republic.5.d3
  }
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  trigger = {
    has_reform = EDG_Ambrose_Philosopher_Council
    # OR = {
    #   is_at_war = yes
    #   num_of_rebel_armies = 1
    
    # }
  }
  immediate = {
    hidden_effect = {
      set_country_flag = ambrosian_republic_5_edg_flag
      if = {
        limit = {
          is_at_war = yes
          NOT = {
            war_with = VEN
          }
        }
        random_country = {
          limit = {
            is_subject = no
            OR = {
              is_in_war = {
                attackers = ROOT
                defender_leader = this
              }
              is_in_war = {
                defenders = ROOT
                attacker_leader = this
              }
            }
          }
          save_event_target_as = sforza_origin_country
        }
      }
      if = {
        limit = {
          any_owned_province = {
            region = italy_region
            is_capital = no
          }
        }
        random_owned_province = {
          limit = {
            is_capital = no
            region = italy_region
          }
          save_event_target_as = sforza_promised_province
        }
      }
    }
  }
  option = {
    name = ambrosian_republic.5.a
    set_country_flag = sforza_hired
    custom_tooltip = EDG_ambrosian_republic_Sforza_TT
    define_general = {
      name = "VgRØe—y ØeèySNb"  # Francesco Sforza
      shock = 5
      fire = 3
      manuever = 4
      siege = 2
    }
    if = {
      limit = {
        num_of_cities = 3
        any_owned_province = {
          region = italy_region
          is_capital = no
        }
      }
      event_target:sforza_promised_province = {
        add_local_autonomy = 50
      }
    }
    if = {
      limit = {
        is_at_war = yes
        NOT = {
          war_with = VEN
        }
      }
      event_target:sforza_origin_country = {
        add_opinion = {
          who = ROOT
          modifier = opinion_swayed_sforza
        }
      }
    }
    else_if = {
      limit = {
        war_with = VEN
      }
      VEN = {
        add_opinion = {
          who = ROOT
          modifier = opinion_swayed_sforza
        }
      }
    }
  }
  option = {
    name = ambrosian_republic.5.b
    ai_chance = {
      factor = 0
    }
    add_stability = -1
    if = {
      limit = {
        war_with = VEN
      }
      VEN = {
        define_general = {
          name = "VgRØe—y ØeèySNb"  # Francesco Sforza
          shock = 5
          fire = 3
          manuever = 4
          siege = 2
        }
        country_event = {
          id = ambrosian_republic.9
        }
      }
    }
    else_if = {
      limit = {
        is_at_war = yes
      }
      event_target:sforza_origin_country = {
        define_general = {
          name = "VgRØe—y ØeèySNb"  # Francesco Sforza
          shock = 5
          fire = 3
          manuever = 4
          siege = 2
        }
        country_event = {
          id = ambrosian_republic.9
        }
      }
    }
    else = {
      random_owned_province = {
        limit = {
          region = italy_region
        }
        spawn_rebels = {
          type = pretender_rebels
          size = 2
          leader = "VgRØe—y"  # Francesco
          leader_dynasty = "ØeèySNb"  # Sforza
        }
      }
    }
  }
}
country_event = {
  id = ambrosian_republic.6
  title = ambrosian_republic.6.t
  desc = ambrosian_republic.6.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  trigger = {
    government = republic
    had_country_flag = {
      flag = sforza_hired
      days = 700
    }
    has_leader = "VgRØe—y ØeèySNb"  # Francesco Sforza
    any_owned_province = {
      region = italy_region
    }
  }
  option = {
    name = ambrosian_republic.6.a
    ai_chance = {
      factor = 75
    }
    if = {
      limit = {
				check_variable = {
					which = EDG_MLO_Sforza_influence_rank
					value = 5
				}
      }
      custom_tooltip = ambrosian_republic_edg_6_a_tt
      hidden_effect = {
        add_adm_power = 100
        add_dip_power = 100
        add_mil_power = 100
        add_stability = 1
      }
    }
    else = {
      add_stability = -1
    }
    add_government_reform = EDG_Military_Dictatorship_Philosopher_Council
    set_country_flag = mlo_military_rule
    custom_tooltip = EDG_ambrosian_republic_Sforza_TT
    define_leader_to_ruler = {
      name = "VgRØe—y ØeèySNb"  # Francesco Sforza
      ADM = 5
      DIP = 5
      MIL = 5
      fixed = yes
    }
  }
  option = {
    name = ambrosian_republic.6.b
    ai_chance = {
      factor = 25
    }
    add_stability = -2
    kill_leader = {
      type = "VgRØe—y ØeèySNb"  # Francesco Sforza
    }
    random_owned_province = {
      limit = {
        region = italy_region
      }
      spawn_rebels = {
        type = pretender_rebels
        size = 2
        leader = "VgRØe—y"  # Francesco
        leader_dynasty = "ØeèySNb"  # Sforza
      }
    }
  }
}
country_event = {
  id = ambrosian_republic.7
  title = ambrosian_republic.7.t
  desc = ambrosian_republic.7.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  trigger = {
    has_reform = EDG_Military_Dictatorship_Philosopher_Council
    had_country_flag = {
      flag = mlo_military_rule
      days = 365
    }
    has_ruler = "VgRØe—y ØeèySNb"  # Francesco Sforza
  }
  immediate = {
    hidden_effect = {
    }
  }
  option = {
    name = "ambrosian_republic.7.a"
    ai_chance = {
      factor = 90
    }
    set_country_flag = ambrosian_republic_resolved
    change_government_to_monarchy = yes
    add_government_reform = EDG_philosopher_king_reform
    add_legitimacy = 50
    define_heir = {
      name = "†R±ÉöNPO õsKNöN"  # Galeazzo Maria
      dynasty = "ØeèySNb"  # Sforza
      birth_date = 1444.1.24
      claim = 100
    }
    add_stability = 1
    custom_tooltip = ambrosian_republic_resolved_tt
  }
  option = {
    name = "ambrosian_republic.7.b"
    ai_chance = {
      factor = 5
    }
    set_country_flag = ambrosian_republic_resolved
    define_ruler = {
      name = "≈ñT^ ÆvGY<S˙ã"  # Jacopo Piccinino
    }
    random_owned_province = {
      limit = {
        region = italy_region
      }
      spawn_rebels = {
        type = pretender_rebels
        size = 2
        leader = "VgRØe—y"  # Francesco
        leader_dynasty = "ØeèySNb"  # Sforza
      }
    }
    custom_tooltip = ambrosian_republic_resolved_tt
  }
  option = {
    name = "ambrosian_republic.7.c"
    ai_chance = {
      factor = 5
    }
    set_country_flag = ambrosian_republic_resolved
    add_government_reform = EDG_Ambrose_Philosopher_Council
    define_ruler = {
      name = "TNªl pQnf<SöN˙ã"  # Giorgio Lampugnano
    }
    random_owned_province = {
      limit = {
        region = italy_region
      }
      spawn_rebels = {
        type = pretender_rebels
        size = 2
        leader = "VgRØe—y"  # Francesco
        leader_dynasty = "ØeèySNb"  # Sforza
      }
    }
    custom_tooltip = ambrosian_republic_resolved_tt
  }
}
country_event = {
  id = ambrosian_republic.8
  title = ambrosian_republic.8.t
  desc = ambrosian_republic.8.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  fire_only_once = yes
  is_triggered_only = yes
  trigger = {
    NOT = {
      has_country_flag = ambrosian_republic_resolved
    }
    has_reform = EDG_Military_Dictatorship_Philosopher_Council
    NOT = {
      has_ruler = "VgRØe—y ØeèySNb"  # Francesco Sforza
    }
  }
  immediate = {
    hidden_effect = {
      set_country_flag = ambrosian_republic_resolved
    }
  }
  option = {
    name = "ambrosian_republic.8.a"
    ai_chance = {
      factor = 25
    }
    add_republican_tradition = -5
    custom_tooltip = ambrosian_republic_resolved_tt
    random_owned_province = {
      limit = {
        region = italy_region
      }
      spawn_rebels = {
        type = particularist_rebels
        size = 1
        leader = "TNªl"  # Giorgio
        leader_dynasty = "pQnf<SöN˙ã"  # Lampugnano
      }
    }
  }
  option = {
    name = "ambrosian_republic.8.b"
    ai_chance = {
      factor = 75
    }
    add_government_reform = EDG_Ambrose_Philosopher_Council
    add_republican_tradition = 20
    define_ruler = {
      name = "TNªl pQnf<SöN˙ã"  # Giorgio Lampugnano
    }
    custom_tooltip = ambrosian_republic_resolved_tt
    random_owned_province = {
      limit = {
        region = italy_region
      }
      spawn_rebels = {
        type = particularist_rebels
        size = 1
        leader = "≈ñT^"  # Jacopo
        leader_dynasty = "ÆvGY<S˙ã"  # Piccinino
      }
    }
  }
}
country_event = {
  id = ambrosian_republic.9
  title = ambrosian_republic.9.t
  desc = ambrosian_republic.9.d
  picture = {
    trigger = {
      has_dlc = "Emperor"
    }
    picture = ITALIAN_wars_eventPicture
  }
  picture = {
    trigger = {
      NOT = {
        has_dlc = "Emperor"
      }
    }
    picture = DEBATE_REPUBLICAN_eventPicture
  }
  is_triggered_only = yes
  option = {
    name = "ambrosian_republic.9.a"
    tooltip = {
      define_general = {
        name = "VgRØe—y ØeèySNb"  # Francesco Sforza
        shock = 5
        fire = 3
        manuever = 4
        siege = 2
      }
    }
  }
}
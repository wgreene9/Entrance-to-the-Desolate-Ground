namespace = EDG_LOT_inheritance
normal_or_historical_nations = yes
country_event = {
  id = EDG_LOT_inheritance.301
  title = "EDG_LOT_inheritance.301.t"
  desc = "EDG_LOT_inheritance.301.d"
  picture = DEATH_OF_HEIR_eventPicture
  is_triggered_only = yes
  fire_only_once = yes
  major = yes
  trigger = {
    
  }
  immediate = {
    set_global_flag = EDG_death_of_lwxd
    hidden_effect = {
      log = "[Root.GetName] has EDG_LOT_War_of_Succession Disaster."
      set_country_flag = EDG_LOT_War_of_Succession_flag
      set_global_flag = EDG_LOT_War_of_Succession_global_flag
      if = {
        limit = {
          has_ruler_flag = EDG_LOT_ludeweixi_ruler_flag
        }
        kill_ruler = yes
      }
    }
    hidden_effect = {
      LOT = {
        every_owned_province = {
          limit = {
            OR = {
              culture_group = germanic
              culture_group = french
              is_part_of_hre = yes
            }
          }
          set_province_flag = EDG_LOT_lowland_demanded_province
        }
       # clr_country_flag = EDG_LOT_succession_start
       # clr_country_flag = EDG_LOT_during_imperial_incident
      }
    }
  }
  option = {
    name = "EDG_LOT_inheritance.301.b"
    trigger = {
      not = { has_global_flag = EDG_game_rule_LOT_must_continue }
    }
    ai_chance = {
      factor = 100
      modifier = {
        factor = 10
        NOT = {
          army_strength = {
            who = emperor
            value = 0.8
          }
        }
      }
      modifier = {
        factor = 0.1
        OR = {
          mil = 5
          army_size = 40
        }
		  }
      modifier = {
        factor = 0
        OR = {
          overlord_of = FRA
          total_development = 500
          has_global_flag = EDG_mission_FRA_5_10_global_flag
        }
      }
    }
    hidden_effect = {
      if = {
        limit = {
          189 = {
            owned_by = ROOT
          }
        }
        189 = {  move_capital_effect = yes }
      }
      every_country = {
        limit = { is_subject_of = root }
        grant_independence = yes
      }
      every_owned_province = {
        limit = {  }
      }
      every_province = {
        limit = {
          has_province_flag = EDG_LOT_lowland_demanded_province
          NOT = { is_capital_of = ROOT }
        }
        set_in_empire = yes
    
        if = {
          limit = {
            any_core_country = {
              exists = no
            }
          }
          random_core_country = {
            limit = {
              NOT = {
                tag = ROOT
              }
              exists = no
            }
            ROOT = {
              release = PREV
            }
            change_government = monarchy
            change_religion = emperor
            define_ruler = {
              claim = 95
            }
            add_government_reform = feudalism_reform
          }
        }
        else_if = {
          limit = {
            owned_by = ROOT
            NOT = {
              region = france_region
            }
          }
          cede_province = emperor
          add_core = emperor
        }
        else_if = {
          limit = {
            region = france_region
          }
          set_in_empire = no
        }
      }
        
      if = {
        limit = { NOT = { exists = LOR } }
        set_government_rank = 1
        change_tag = LOR
        restore_country_name = yes
        swap_non_generic_missions = yes
        if = {
          limit = {
            has_custom_ideas = no
          }
          country_event = { id = ideagroups.1 } #Swap Ideas
        }

      }
      custom_tooltip = EDG_LOT_inheritance_301_b_tt_1
      if = {
        limit = { NOT = { exists = LOR } }
        custom_tooltip = EDG_SPACE_TT
        custom_tooltip = EDG_LOT_inheritance_301_b_tt_2
      }
    }
  }
  option = {
      name = "EDG_LOT_inheritance.301.a"
      trigger = {
        not = { has_global_flag = EDG_game_rule_LOT_must_break }
      }
      ai_chance = {
        factor = 10
        modifier = {
          factor = 1.5
          army_strength = {
            who = emperor
            value = 0.9
          }
        }
        modifier = {
          factor = 3
          army_strength = {
            who = emperor
            value = 1.25
          }
        }
        modifier = {
          factor = 5
          army_strength = {
            who = emperor
            value = 1.5
          }
        }
        modifier = {
          factor = 50
          army_strength = {
            who = emperor
            value = 2
          }
        }
      }
      if = {
        limit = {
          has_global_flag = EDG_mission_FRA_5_10_global_flag
        }
        FRA = {
          add_casus_belli = {
            type = cb_restore_personal_union
            months = 300
            target = ROOT
          }
        }
      }
      emperor = {
        if = {
          limit = {
            OR = {
              hre_reform_passed = emperor_reichsreform
              hre_reform_passed = reichsreform
            }
          }
          add_casus_belli = {
            target = ROOT
            type = cb_imperial_ban_incident
            months = 60
          }
        }
        else = {
          add_casus_belli = {
            target = ROOT
            type = cb_liberation
            months = 60
          }
        }
      }
	
      every_province = {
        limit = {
          has_province_flag = EDG_LOT_lowland_demanded_province
          NOT = { is_capital_of = ROOT }
        }
		
        spawn_rebels = {
          type = nationalist_rebels
          size = 1
          unrest = 20
        }
      }
  }
}
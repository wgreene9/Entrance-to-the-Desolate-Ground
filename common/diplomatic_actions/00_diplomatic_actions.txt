# INSTRUCTIONS:
#
# condition				A diplomatic action can have any number of condition blocks, each with its own
#						tooltip, potential and allow section
#
# 	tooltip					Sets a custom text string similar to the hardcoded limits
# 							If no tooltip is scripted, the tooltip for the actual trigger will be shown
#							Note that the custom tooltip is only shown if the allow trigger is NOT met
#
# 	potential				Determines if the trigger is applicable or not
# 	allow					Determines if the action is valid or not
#
# effect				A diplomatic action can only have one effect block

# ROOT					actor
# FROM					target

########################################
# DIPLOMATIC ACTIONS
########################################
# royal_marriage				#王室联姻
# declarewar					#宣战
# requestpeace					#请求和平
# support_independence_action	#支持独立
# allianceaction				#结盟
# embargoaction					#禁运
# annexationaction				#吞并
# integrationaction				#合并
# vassalaction					#要求附庸
# guaranteeaction				#保独
# warningaction					#警告
# threaten_war					#威胁开战
# milaccess						#请求军通
# fleet_access					#请求停泊
# offer_fleet_access			#授予停泊
# offermilaccess				#授予军通
# insultaction					#羞辱
# giftaction					#送礼
# claimaction					#制造宣称
# callaction					#召集盟友
# offerloan						#提供贷款
# warsubsidy					#战争援助
# sellprov						#售卖省份
#神罗互动
# imperial_relations_action		
# imperial_realm_war_action
# religious_unity_action
# grant_electorate				
# remove_electorate
# grant_freecity
# remove_freecity
# demand_unlawful_territory_action
# call_crusade_action
# excommunicate_action
# enforce_peace					#强制和平
# improve_relation				#改善关系
# fabricate_claim				#制造宣称
# justify_trade_conflict		#制造贸易争端
# transfer_trade_power			#转移贸易竞争力
# infiltrate_administration		#渗透政府
# sabotage_reputation			#破坏声誉
# support_rebels				#支持叛军
# sow_discontent				#挑动不满
# agitate_for_liberty			#鼓动自由
# form_coalition				#组建包围网
# request_to_join_federation
# invite_to_federation
# support_heir					#支持继承人
# break_marriage				#撕毁盟约
# designate_march				#指定卫戍
# ask_for_march					#请求卫戍
# sell_ships_action				#出售船只
# abandon_union					#打破联统
# takeondebt					#承担债务
# influence_nation				#影响国家
# claim_states					#
# steer_trade					#
# stealmap						
# spy_network
# invite_to_trade_league
# request_to_join_trade_league
# sharemap
# intervene_in_war
# break_alliance
# tributary_state_action		#朝贡
# ask_for_tributary_state_action#朝贡
# knowledge_sharing


#Cut because the Grand Crusade war doesn't really have any place in the current content, but it could be very useful for the future.
#Also modders should have the chance to just uncomment it all so they can experience the great 30 Years War like Crusade.
declarewar = {
	condition = {
		tooltip = GRAND_CRUSADE_NO_OTHER_WAR
		potential = { }
		allow = {
			NOT = {
				is_in_war = {
					attacker_leader = ROOT
					casus_belli = cb_grand_crusade
				}
			}
		}
	}
	condition = {
		tooltip = AI_CANNOT_DECLARE_WHEN_STABILITY_LOSS
		potential = {
			ai = yes
		}
		allow = {
			ai = yes
			NOT = {
				has_global_modifier_value = {
					which = stability_cost_to_declare_war
					value = 1
				}
			}
		}
	}
	condition = {
		tooltip = CANNOT_DECLARE_WARS_OTHER_THAN_INDEPENDENCE_WARS
		potential = {
			has_country_modifier = revoked_war_rights
			FROM = { NOT = { overlord_of = ROOT } }
		}
		allow = {
			OR = {
				NOT = { has_country_modifier = revoked_war_rights }
				FROM = { overlord_of = ROOT }
			}
		}
	}
	condition = {
		tooltip = CANNOT_DECLARE_WARS_TEUTONS_HRE
		potential = {
			ai = yes 
			has_country_flag = teu_joined_the_hre
			FROM = { is_part_of_hre = yes }
		}
		allow = { 
			FROM = { is_part_of_hre = no }
		}
	}
	condition = {
		tooltip = EDG_GAME_RULE_DISABLE_DECLARE_WAR
		potential = {
			ai = yes 
			OR = {
				tag = SHY
				was_tag = SHY
			}
			has_global_flag = EDG_game_rule_2_7_ban_flag
		}
		allow = { 
			always = no
		}
	}
	condition = { #东方卫戍领
		tooltip = EDG_TEU_CANNOT_DECLARE_WARS_EASTERN_GARRISON
		potential = {
			has_ruler_modifier = EDG_TEU_eastern_garrison_modifier
			is_emperor = no
			FROM = { is_part_of_hre = yes }
		}
		allow = { 
			FROM = { is_part_of_hre = no }
		}
	}
	condition = { #丹麦邦联
		tooltip = EDG_DAN_MEMBER_STATES_OF_DANISH_DECLARE_WAR
		potential = { 
			has_global_flag = EDG_DAN_enable_states_of_danish_federation_flag
			has_country_flag = EDG_DAN_member_states_of_danish_federation_flag
		}
		allow = { 
			has_country_flag = EDG_DAN_presidency_states_of_danish_federation_flag
		}
	}
	condition = { #帖木儿继承危机
		tooltip = EDG_TIM_CANT_DECLARE_WARS_DURING_SUCCESSION_CRISIS
		potential = {
			ai = yes
			FROM = {
				has_country_modifier = EDG_TIM_succession_crisis_modifier
			}
		}
		allow = { 
			always = no
		}
	}
	condition = { #继业者战争
		tooltip = EDG_BDX_CANT_DECLARE_WARS_DURING_DIADOCHI_WAR
		potential = {
			ai = yes
			FROM = {
				has_disaster = EDG_BDX_diadochi_war_disaster
				has_country_flag = EDG_BDX_is_diadochi_tag_flag
			}
		}
		allow = { 
			always = no
		}
	}
	condition = { #艾瑟尔
		tooltip = EDG_H04_CAN_NOT_DECLARE_WAR_ALLIAN_ETHEL
		potential = {
			has_global_flag = EDG_H04_can_not_declare_war_allian_ethel_flag
		}
		allow = { 
			if = {
				limit = {
					any_ally = {
						has_country_flag = EDG_H04_enable_flag
					}
					FROM = {
						any_ally = {
							has_country_flag = EDG_H04_enable_flag
						}
					}
				}
				always = no
			}
			
		}
	}
	effect = {
		on_war_declaration_effect = yes
		if = {
			limit = {
				has_global_flag = grand_crusades_enabled
				has_country_flag = grand_crusader_war_monger_flag
				is_in_war = {
					attacker_leader = ROOT
					casus_belli = cb_grand_crusade
				}
			}
			change_variable = {
				which = EDG_num_grand_crusade
				value = 1
			}
			FROM = {
				save_global_event_target_as = grand_crusade_target
			}
		}
		if = {
			limit = { 
				has_country_flag = nor_norwegian_independence_modifier
				FROM = { tag = DAN }
			}
			add_country_modifier = {
				name = nor_norwegian_independence_war_mod
				duration = -1
			}
		}
		if = {
			limit = {
				has_country_flag = teu_joined_the_hre
				tag = TEU
				is_part_of_hre = yes
				FROM = { is_part_of_hre = yes }
			}
			clr_country_flag = teu_joined_the_hre
			country_event = {
				id = flavor_teu.33
				days = 10
			}
		}
		if = {
			limit = { 
				root = {
					has_country_flag = enable_pirate_raid_cb_flag
					NOT = {
						has_country_modifier = EDG_GOT_intruder_operation
					}
				}
			}
			from = {
				add_country_modifier = {
					name = EDG_GOT_afraid_of_shadow
					duration = 365
				}
			}
			add_country_modifier = {
				name = EDG_GOT_intruder_operation
				duration = 365
			}
		}
		if = {
			limit = { 
				has_country_flag = EDG_GOT_begin_surpise_war_flag
			}
			clr_country_flag = EDG_GOT_begin_surpise_war_flag
		}
		if = {
			limit = { 
				has_government_mechanic = EDG_GOT_infarmy_mechanic
			}
			add_government_power = {
				mechanic_type = EDG_GOT_infarmy_mechanic
				power_type = EDG_GOT_infarmy
				value = 1
			}
		}
		if = {
			limit = { 
				has_government_mechanic = EDG_PRU_honor_of_iron_and_blood_mechanic
				from = {
					is_part_of_hre = yes 
				}
			}
			add_government_power = {
				mechanic_type = EDG_PRU_honor_of_iron_and_blood_mechanic
				power_type = EDG_PRU_honor_of_iron_and_blood
				value = -10
			}
		}
		if = {
			limit = { 
				has_ruler_modifier = EDG_TEU_eastern_garrison_modifier
				is_emperor = no
				hre_size = 1
			}
			emperor = {
				add_imperial_influence = 5
			}
		}
		if = {
			limit = { 
				has_government_mechanic = EDG_WAL_atrocity_mechanic
			}
			add_government_power = {
				mechanic_type = EDG_WAL_atrocity_mechanic
				power_type = EDG_WAL_atrocity
				value = 5
			}
		}
	}
}

allianceaction = {
	condition = {
		tooltip = PIRATE_DENIED_ALLIANCE
		potential = {
			has_government_attribute = cannot_ally_non_pirates
		}
		allow = {
			OR = {
				NOT = { has_government_attribute = cannot_ally_non_pirates }
				FROM = { has_government_attribute = is_pirate_republic_reform }
			}
		}
	}
	condition = {
		tooltip = FROM_PIRATE_DENIED_ALLIANCE
		potential = {
			FROM = {
				has_government_attribute = cannot_ally_non_pirates
			}
			NOT = { has_government_attribute = is_pirate_republic_reform }
		}
		allow = {
			OR = {
				has_government_attribute = is_pirate_republic_reform
				NOT = { FROM = { has_government_attribute = cannot_ally_non_pirates } }
			}
		}
	}
	condition = {
		tooltip = REPUBLIC_DENIED_ALLIANCE
		potential = {
			has_government_attribute = cannot_ally_non_republics
		}
		allow = {
			OR = {
				NOT = { has_government_attribute = cannot_ally_non_republics }
				FROM = { government = republic }
			}
		}
	}
	condition = {
		tooltip = FROM_REPUBLIC_DENIED_ALLIANCE
		potential = {
			FROM = {
				has_government_attribute = cannot_ally_non_republics
			}
			NOT = { government = republic }
		}
		allow = {
			OR = {
				government = republic
				NOT = { FROM = { has_government_attribute = cannot_ally_non_republics } }
			}
		}
	}
	condition = {
		tooltip = REV_REPUBLIC_DENIED_ALLIANCE
		potential = {
			has_government_attribute = cannot_ally_non_republics_or_non_rev
		}
		allow = {
			OR = {
				NOT = { has_government_attribute = cannot_ally_non_republics_or_non_rev }
				FROM = { 
					OR = {
						government = republic 
						is_revolutionary = yes
					}
				}
			}
		}
	}
	condition = {
		tooltip = FROM_REV_REPUBLIC_DENIED_ALLIANCE
		potential = {
			FROM = {
				has_government_attribute = cannot_ally_non_republics_or_non_rev
			}
			NOT = { government = republic }
			is_revolutionary = no
		}
		allow = {
			OR = {
				government = republic 
				is_revolutionary = yes
				NOT = { FROM = { has_government_attribute = cannot_ally_non_republics_or_non_rev } }
			}
		}
	}
	condition = {
		tooltip = CANNOT_MAKE_ALLIANCES
		potential = {
			has_government_attribute = cannot_form_alliances
		}
		allow = {
			NOT = { has_government_attribute = cannot_form_alliances }
		}
	}
	condition = {
		tooltip = FROM_CANNOT_MAKE_ALLIANCES
		potential = {
			FROM = {
				has_government_attribute = cannot_form_alliances
			}
		}
		allow = {
			NOT = { FROM = { has_government_attribute = cannot_form_alliances } }
		}
	}
	condition = {
		tooltip = EDG_TIM_CANT_DECLARE_WARS_DURING_SUCCESSION_CRISIS
		potential = {
			ai = yes
			is_subject = yes
			has_country_modifier = EDG_TIM_succession_crisis_modifier			
		}
		allow = { 
			always = no
		}
	}
	condition = {
		tooltip = EDG_H04_CAN_NOT_ALLIAN_WITH_NOT_HRE_MEMBER
		potential = {
			has_global_flag = EDG_H04_disable_alliance_with_not_hre_member_flag
			is_emperor = no
			OR = {
				AND = {
					is_part_of_hre = yes
					FROM = {
						is_part_of_hre = no
					}
				}
				AND = {
					is_part_of_hre = no
					FROM = {
						is_part_of_hre = yes
					}
				}
			}
			
		}
		allow = {
			always = no
		}
	}
	condition = {
		tooltip = EDG_DISABLE_ALLIAN_FROM_ATTRIBUTE
		potential = {
			has_government_attribute = EDG_disable_allian
		}
		allow = {
			always = no
		}
	}
	condition = {
		tooltip = EDG_DISABLE_ALLIAN_FROM_ATTRIBUTE_FROM
		potential = {
			FROM = {
				has_government_attribute = EDG_disable_allian
			}
		}
		allow = {
			always = no
		}
	}
	condition = {
		tooltip = EDG_BAV_CAN_NOT_ALLIAN_WITH_HABSBURG
		potential = {
			OR = {
				AND = {
					ai = no
					EDG_BAV_is_bavarian_country_trigger = yes
					FROM = {
						OR = {
							tag = WUR
							tag = HAB
						}
					}
				}
				AND = {
					OR = {
						tag = WUR
						tag = HAB
					}
					FROM = {
						ai = no
						EDG_BAV_is_bavarian_country_trigger = yes
					}
				}
			}
		}
		allow = {
			always = no
		}
	}
	effect = {
		change_asha_vahishta = { value = 2 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 2
			}
		}
	}
}

enforce_peace = {
	#do this before the peace is enforced, or there is no war enemy country
	pre_effect = {
		if = {
			limit = {
				has_country_modifier = liv_protector_of_the_catholics
				FROM = {
					any_war_enemy_country = {
						religion = catholic
						is_in_war = {
							defender_leader = THIS
							attacker_leader = FROM
						}
					}
				}
			}
			add_papal_influence = 25
		}
		if = {
			limit = {
				has_government_mechanic = the_three_royal_fires_mechanic
				FROM = {
					any_war_enemy_country = {
						religion = zoroastrian
						is_in_war = {
							defender_leader = this
							attacker_leader = from
						}
					}
				}
			}
			change_asha_vahishta = { value = 5 }
		}
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
				FROM = {
					any_war_enemy_country = {
						religion = zoroastrian
						is_in_war = {
							defender_leader = this
							attacker_leader = from
						}
					}
				}
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 5
			}
		}
	}
}

royal_marriage = {
	condition = {
		tooltip = MARWAR
		potential = {
		}
		allow = {
			NOT = { war_with = FROM }
		}
	}
	condition = {	#爱尔兰
		tooltip = EDG_IRE_LONG_CHERISHED_WISH_CAN_NOT_ROYAL_MARRIAGE
		potential = { 
			OR = {
				has_ruler_modifier = EDG_IRE_long_cherished_wish
				FROM = {
					has_ruler_modifier = EDG_IRE_long_cherished_wish
				}
			}
		}
		allow = { 
			always = no
		}
	}
	condition = {
		tooltip = EDG_WAL_WALRYS_PIERCING_COLLAR_ROYAL_MARRIAGE
		potential = { 
			OR = {
				has_reform = EDG_WAL_walrys_piercing_collar
				FROM = {
					has_reform = EDG_WAL_walrys_piercing_collar
				}
			}
		}
		allow = {
			always = no
		}
	}
	condition = {
		tooltip = EDG_MEN_ROYAL_MARRIAGE
		potential = { 
			OR = {
				has_ruler_modifier = EDG_MEN_ibashi_buhun_modifier 				
				FROM = {
					has_ruler_modifier = EDG_MEN_ibashi_buhun_modifier 					
				}
			}
		}
		allow = {
			always = no
		}
	}	
	effect = {
		change_asha_vahishta = { value = 0.5 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 0.5
			}
		}
	}
}

guaranteeaction = {
	effect = {
		change_asha_vahishta = { value = 1 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 1
			}
		}
	}
}
threaten_war = {
	effect = {
		change_asha_vahishta = { value = -10 }
	}
}
insultaction = {
	effect = {
		change_asha_vahishta = { value = -5 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = -5
			}
		}
		if = {
			limit = { 
				OR = {
					FROM = {
						is_rival = root
					}
					is_rival = FROM
				}
				has_government_mechanic = EDG_WAL_atrocity_mechanic
			}
			add_government_power = {
				mechanic_type = EDG_WAL_atrocity_mechanic
				power_type = EDG_WAL_atrocity
				value = 5
			}
		}
	}
}
giftaction = {
	effect = {
		change_asha_vahishta = { value = 1 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 1
			}
		}
	}
}
fabricate_claim = {
	effect = {
		change_asha_vahishta = { value = -1 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = -1
			}
		}
	}
}
break_marriage = {
	effect = {
		change_asha_vahishta = { value = -1 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = -1
			}
		}
		if = {
			limit = { 
				OR = {
					has_country_flag = EDG_H04_enable_allian_for_history_friend_flag
					FROM = {
						has_country_flag = EDG_H04_enable_allian_for_history_friend_flag
					}
				}
			}
			remove_historical_friend = FROM
			FROM = {
				remove_historical_friend = root
			}
		}
	}
}
takeondebt = {
	effect = {
		change_asha_vahishta = { value = 2 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 2
			}
		}
	}
}
influence_nation = {
	effect = {
		change_asha_vahishta = { value = 2 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 2
			}
		}
	}
}
intervene_in_war = {
	effect = {
		change_asha_vahishta = { value = 50 }
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = 50
			}
		}
	}
}

annexationaction = {
	condition = {		#EDG
		tooltip = EDG_BAN_ANNEXE
		potential = { 
			has_government_attribute = EDG_BRA_ban_annex
		}
		allow = { 
			always = no
		}
	}
	condition = {
		tooltip = ANNEX_TOO_LOW
		potential = {
			FROM = {
				OR = {
					is_subject_of_type = core_eyalet
					is_subject_of_type = appanage
					vassal_of = ROOT
				}
			}
			not = { mission_completed = EDG_mission_LOT_3_5 }
		}
		allow = {
			FROM = {
				has_opinion = {
					who = ROOT
					value = 190
				}
			}
		}
	}
	#condition = {
	#	tooltip = ANNEXINVALID
	#	potential = {
	#		FROM = {
	#			vassal_of = ROOT
	#		}
	#	}
	#	allow = {
	#		FROM = {
	#			years_in_vassalage_under = {
	#				who = ROOT
	#				years = 10
	#			}
	#		}
	#	}
	#}
	condition = {
		tooltip = CANNOT_ANNEX
		potential = {
			FROM = {
				has_country_modifier = tur_mamlukian_administration
			}
		}
		allow = {
			FROM = {
				NOT = { has_country_modifier = tur_mamlukian_administration }
			}
		}
	}
	condition = {
		tooltip = NEEDS_50_CROWNLAND_TT
		potential = {
			has_government_attribute = need_crownland_to_annex
			NOT = { crown_land_share = 50 }
		}
		allow = {
			crown_land_share = 50
		}
	}
	condition = {
		tooltip = NEEDS_TO_HAVE_SEIZED_LAND
		potential = {
			has_government_attribute = has_appanages
			NOT = {
				check_variable = {
					which = can_annex_appanages_points
					value = 1
				}
			}
		}
		allow = {
			check_variable = {
				which = can_annex_appanages_points
				value = 1
			}
		}
	}
	condition = {
		tooltip = EDG_TIM_CANT_ANNEX_KHIVA
		potential = {
			has_estate_privilege = estate_EDG_TIM_khiva_privilege
		}
		allow = {
			always = no
		}
	}
	effect = {
		if = {
			limit = {
				FROM = { is_subject_of_type = appanage }
			}
			subtract_variable = {
				which = can_annex_appanages_points
				value = 1
			}
		}
	}
}

integrationaction = {
	condition = {		#EDG
		tooltip = EDG_BAN_INTEGRATION
		potential = { 
			has_government_attribute = EDG_BRA_ban_annex
		}
		allow = { 
			always = no
		}
	}
	condition = {
		tooltip = INTEGRATETOOLOWDESC
		potential = {
			senior_union_with = FROM
		}
		allow = {
			FROM = {
				has_opinion = {
					who = ROOT
					value = 190
				}
			}
		}
	}
	condition = {
		tooltip = PUINTEGRATIONIMPOSSIBLE
		potential = {
			has_government_attribute = cannot_integrate_personal_unions
		}
		allow = {
			NOT = { has_government_attribute = cannot_integrate_personal_unions }
		}
	}
	condition = {
		tooltip = CANNOT_ANNEX
		potential = {
			FROM = {
				has_country_modifier = tur_mamlukian_administration
			}
		}
		allow = {
			FROM = {
				NOT = { has_country_modifier = tur_mamlukian_administration }
			}
		}
	}
}

vassalaction = {
	condition = {
		tooltip = VASSALINVALID
		potential = {
		}
		allow = {
			alliance_with = FROM
			FROM = {
				has_opinion = {
					who = ROOT
					value = 190
				}
			}
			FROM = { is_at_war = no }
		}
	}
}

abandon_union = {
	condition = {
		tooltip = IS_EDG_GEN_CHARTERED_BANK
		potential = { 
			from = {
				is_subject_of_type = EDG_GEN_chartered_bank
			}
		}
		allow = {
			always = no
		}
	}
	condition = {
		potential = {
		}
		allow = {
			ROOT = {
				senior_union_with = FROM
				is_at_war = no
			}
		}
	}
	condition = {
		tooltip = PUABANDONINGIMPOSSIBLE
		potential = {
			has_government_attribute = cannot_abandon_personal_unions
		}
		allow = {
			NOT = { has_government_attribute = cannot_abandon_personal_unions }
		}
	}
}

form_coalition = {
	condition = {
		tooltip = MINAGGRESSIVEEXPANSION
		potential = {	
		}
		allow = {
			has_opinion_modifier = {
				modifier = aggressive_expansion
				who = FROM
			}		
			NOT = {
				has_opinion_modifier = {
					modifier = aggressive_expansion
					who = FROM
					value = -49
				}
			}
		}
	}
	condition = {
		tooltip = EDG_TEU_EASTERN_GARRISON_CAN_NOT_JOI
		potential = { 
			is_part_of_hre = yes
			FROM = {
				has_ruler_modifier = EDG_TEU_eastern_garrison_modifier
				is_emperor = no
			}
		}
		allow = { 
			always = no
		}
	}
	condition = {
		tooltip = MINAGGRESSIVEEXPANSION
		potential = { }
		allow = {
			if = {
				limit = { 
					FROM = { 
						has_country_flag = EDG_form_coalition_Need_75_ae_flag
					}
				}
				NOT = { guaranteed_by = FROM }
				has_opinion_modifier = {
					modifier = aggressive_expansion
					who = FROM
				}		
				NOT = {
					has_opinion_modifier = {
						modifier = aggressive_expansion
						who = FROM
						value = -49
					}
				}
			}
			else_if = {
				limit = {
					FROM = { 
						has_country_flag = EDG_form_coalition_Need_75_ae_flag
					}
				}
				guaranteed_by = FROM
				has_opinion_modifier = {
					modifier = aggressive_expansion
					who = FROM
				}		
				NOT = {
					has_opinion_modifier = {
						modifier = aggressive_expansion
						who = FROM
						value = -74
					}
				}
			}
			else = {
				has_opinion_modifier = {
					modifier = aggressive_expansion
					who = FROM
				}		
				NOT = {
					has_opinion_modifier = {
						modifier = aggressive_expansion
						who = FROM
						value = -49
					}
				}
			}
		}
	}
}

request_to_join_trade_league = {
	condition = {
		tooltip = NOT_RELEVANT_TRADE_REGION_FROM
		potential = {
		}
		allow = {
			home_trade_node = {
				trade_share = {
					country = from
					share = 1
				}
			}
		}
	}
}

invite_to_trade_league = {
	condition = {
		tooltip = NOT_RELEVANT_TRADE_REGION
		potential = {
		}
		allow = {
			from = {
				home_trade_node = {
					trade_share = {
						country = root
						share = 1
					}
				}
			}
		}
	}
}

tributary_state_action = {
	condition = {
		potential = {
			ai = yes
		}
		allow = {
			OR = {
				NOT = { ROOT = { capital_scope = { superregion = china_superregion } } }
				AND = {
					ROOT = { capital_scope = { superregion = china_superregion } }
					NOT = { FROM = { capital_scope = { superregion = china_superregion } } }
				}
			}
			OR = {
				NOT = { ROOT = { capital_scope = { region = japan_region } } }
				AND = {
					ROOT = { capital_scope = { region = japan_region } }
					NOT = { FROM = { capital_scope = { region = japan_region } } }
				}
			}
		}
	}
}
ask_for_tributary_state_action = {
	condition = {
		potential = {
			ai = yes
		}
		allow = {
			OR = {
				NOT = { FROM = { capital_scope = { superregion = china_superregion } } }
				AND = {
					FROM = { capital_scope = { superregion = china_superregion } }
					NOT = { ROOT = { capital_scope = { superregion = china_superregion } } }
				}
			}
			OR = {
				NOT = { FROM = { capital_scope = { region = japan_region } } }
				AND = {
					FROM = { capital_scope = { region = japan_region } }
					NOT = { ROOT = { capital_scope = { region = japan_region } } }
				}
			}
		}
	}
}

break_alliance = {
	effect = {
		on_alliance_broken_effect = yes
		if = {
			limit = {
				has_reform = EDG_new_ERS_new_Tianze_Monarchy_reforms
			}
			add_government_power = {
				mechanic_type = EDG_ERS_new_Asha_Wahishta_ability
				power_type = EDG_ERS_new_Asha_Wahishta_power
				value = -10
			}
		}
	}
}
###EDG

callaction = {
	condition = { #海盗突袭
		tooltip = EDG_PLUNDER_WAR_CALL
		potential = {
			OR = {
				is_in_war = { 
					casus_belli = cb_EDG_pirate_raid 
					attacker_leader = GOT
				}
				is_in_war = { 
					casus_belli = cb_EDG_pirate_raid 
					attacker_leader = DDF
				}
			}
		}
		allow = {
			always = no
			# GOT = {
			# 	has_country_flag = EDG_GOT_begin_surpise_war_flag
			# }
			# NOT = {
			# 	has_country_modifier = EDG_GOT_afraid_of_shadow
			# }
			# GOT = {
			# 	NOT = {
			# 		has_country_modifier = EDG_GOT_intruder_operation
			# 	}
			# }
		}
	}
	condition = { #伊比利亚宗教战争
		tooltip = EDG_FOI_IBERIAN_UNIFICATION_CALL
		potential = { 
			# NOT = {
			# 	has_global_flag = IBR_conflict_end_flag
			# }
			is_in_war = {
				casus_belli = cb_EDG_WG_superiority_IBR_unification
			}
		}
		allow = { 
			OR = {
				overlord_of = FROM        
				is_subject_of = FROM  
				# AND = {
				# 	FROM = {
				# 		tag = AEL
				# 	}
				# 	tag = CAT
				# }
			}
		}
	}
	condition = { #任意战争中的敌人处于伊比利亚纷争
		tooltip = EDG_FOI_IBERIAN_STRIFE_CALL
		potential = { 
			any_war_enemy_country = {
				OR = {
					has_country_modifier = FOI_last_battle_for_iberia
					has_country_modifier = FOI_iberian_strife
				}
			}
		}
		allow = { 
			OR = {
				overlord_of = FROM        
				is_subject_of = FROM  
				# AND = {
				# 	FROM = {
				# 		tag = AEL
				# 	}
				# 	tag = CAT
				# }
			}
		}
	}
	condition = { #盟友或自己处于伊比利亚纷争
		tooltip = EDG_FOI_alliance_IN_IBERIAN_STRIFE_CALL
		potential = {
			OR = {
				FROM = {
					OR = {
						has_country_modifier = FOI_last_battle_for_iberia
						has_country_modifier = FOI_iberian_strife
					}
				}
				has_country_modifier = FOI_last_battle_for_iberia
				has_country_modifier = FOI_iberian_strife
			} 
		}
		allow = { 
			OR = {
				overlord_of = FROM        
				is_subject_of = FROM  
				# AND = {
				# 	FROM = {
				# 		tag = AEL
				# 	}
				# 	tag = CAT
				# }
			}
		}
	}
	condition = { #盟友是帝国成员且进攻者签署了东方卫戍条例
		tooltip = EDG_TEU_EASTERN_GARRISON_CALL
		potential = { 
			FROM = {
				is_part_of_hre = yes
			}
			OR = {
				AND = {
					OR = {
						is_in_war = {
							attacker_leader = TEU
						}
						is_in_war = {
							defender_leader = TEU
						}
					}
					TEU = {
						has_ruler_modifier = EDG_TEU_eastern_garrison_modifier
						is_emperor = no
					}
				}
				AND = {
					OR = {
						is_in_war = {
							attacker_leader = PRU
						}
						is_in_war = {
							defender_leader = PRU
						}
					}
					PRU = {
						has_ruler_modifier = EDG_TEU_eastern_garrison_modifier
						is_emperor = no
					}
				}
			}
		}
		allow = { 
			OR = {
				overlord_of = FROM        
				is_subject_of = FROM  
				tag = TEU
				tag = PRU
			}
		}
	}
	condition = { #丹麦邦联成员禁止参战
		tooltip = EDG_DAN_MEMBER_STATES_OF_DANISH_CALL
		potential = { 
			has_global_flag = EDG_DAN_enable_states_of_danish_federation_flag
			FROM = {
				has_country_flag = EDG_DAN_member_states_of_danish_federation_flag
			}
		}
		allow = { 
			OR = {
				overlord_of = FROM        
				is_subject_of = FROM  
				FROM = {
					has_country_flag = EDG_DAN_presidency_states_of_danish_federation_flag
				}
				has_country_flag = EDG_DAN_member_states_of_danish_federation_flag
			}
		}
	}
	condition = { #爱尔兰进攻苏格兰
		tooltip = EDG_IRE_LIGHT_WAR_WITH_SCO_CALL
		potential = { 
			is_in_war = {
				casus_belli = cb_annex
				attacker_leader = IRE
				defender_leader = SCO
			}
		}
		allow = { 
			IRE = {
				NOT = {
					has_country_flag = EDG_IRE_get_ready_light_war
				}
			}
		}
	}
	condition = { #萨克森进攻
		tooltip = EDG_SAX_WAR_WITH_BRA_CALL
		potential = { 
			is_in_war = {
				casus_belli = cb_insult
				attacker_leader = SAX
				defender_leader = BRA
			}
			has_country_flag = EDG_BRA_against_SAX
		}
		allow = { 
			OR = {
				is_subject_of = FROM
				overlord_of = FROM
			}
		}
	}
	condition = { #勃兰登堡
		tooltip = EDG_BRA_SPECIAL_WAR_CALL
		potential = {
			is_in_war = {
				casus_belli = cb_BRA_brandenburg_war
			}
		}
		allow = { 
			always = no
		}
	}
	condition = { #热那亚
		tooltip = EDG_GEN_CAN_NOT_CALL
		potential = {
			OR = {
				AND = {
					GEN = {
						has_country_flag = EDG_GEN_mission_3_1_flag
					}
					is_in_war = {
						casus_belli = cb_annex
						attacker_leader = GEN
						defender_leader = COR
					}
				}
				AND = {
					GEN = {
						has_country_modifier = EDG_GEN_follow_up_victry
					}
					is_in_war = {
						attacker_leader = GEN
						defender_leader = SAR
					}
				}
				AND = {
					GEN = {
						has_country_flag = EDG_GEN_mission_2_5_flag
					}
					is_in_war = {
						casus_belli = cb_core
						war_goal_province = 4700
						attacker_leader = GEN
						defender_leader = MOE
					}
				}
				AND = {
					GEN = {
						has_country_flag = EDG_GEN_mission_4_5_flag
					}
					is_in_war = {
						casus_belli = cb_core
						war_goal_province = 286
						attacker_leader = GEN
						defender_leader = AZO
					}
				}
				AND = {
					GEN = {
						has_country_flag = EDG_GEN_mission_c_3_3_flag
					}
					is_in_war = {
						casus_belli = cb_annex
						attacker_leader = GEN
						defender_leader = MLO
					}
				}
			}
		}
		allow = {
			OR = {
				is_subject_of = FROM
				overlord_of = FROM
			}
		}
	}
	condition = {
		tooltip = EDG_IS_FREE_ALLIAN
		potential = {
			any_war_enemy_country = {
				has_government_attribute = EDG_enable_freedom_allian 
			}
		}
		allow = {
			FROM = {
				NOT = {
					is_subject_of_type = EDG_SWI_free_alliance
				}
			}
		}
	}
	condition = { #瓦拉几亚
		tooltip = EDG_WAL_CAN_NOT_CALL
		potential = { 
			WAL = {
				has_country_flag = EDG_WAL_mission_4_2_flag
			}
			is_in_war = {
				casus_belli = cb_annex
				attacker_leader = WAL
				defender_leader = HUN
			}
		}
		allow = {
			always = no
		}
	}
	condition = { #魏玛
		tooltip = EDG_WAL_CAN_NOT_CALL
		potential = { 
			H07 = {
				has_country_flag = EDG_H07_mission_4_4_flag
			}
			is_in_war = {
				casus_belli = cb_core
				attacker_leader = H07
				defender_leader = MEI
			}
		}
		allow = {
			always = no
		}
	}
	condition = { #斯摩棱斯克
		tooltip = EDG_WAL_CAN_NOT_CALL
		potential = { 
			SMO = {
				has_country_flag = EDG_SMO_mission_3_1_flag
			}
			is_in_war = {
				casus_belli = cb_core
				attacker_leader = SMO
				defender_leader = CHR
			}
		}
		allow = {
			always = no
		}
	}
	condition = { #法兰克福
		potential = { 
			FROM = {
				has_reform = EDG_FRN_free_city
			}
		}
		allow = { 
			always = no
		}
	}
	effect = {
		if = {
			limit = { 
				tag = CAT
				FROM = {
					tag = AEL
				}
			}
			change_variable = {
				which = ask_arles_for_help_value
				value = 1
			}
		}
		if = {
			limit = { 
				NOT = {
					has_country_modifier = EDG_H04_at_one_fling
				}
				has_country_flag = EDG_H04_mission_5_10_flag
			}
			FROM = {
				add_country_modifier = {
					name = EDG_H04_at_one_fling
					duration = 3650
				}
			}
		}
	}
}
offerloan = {
	effect = {
		if = {
			limit = { 
				has_government_mechanic = EDG_GEN_george_house_workpiece_ratio_mechanic
			}
			add_government_power = {
				mechanic_type = EDG_GEN_george_house_workpiece_ratio_mechanic
				power_type = EDG_GEN_george_house_workpiece_ratio
				value = 1
			}
		}
	}
}
remove_freecity = {
	condition = {
		tooltip = IS_EDG_HSA_FREE_CITY
		potential = { 
			FROM = {
				OR = {
					has_reform = EDG_HSA_hanseatic_league
					has_reform = EDG_HSA_hanseatic_free_city
				}
			}
		}
		allow = {
			always = no
		}
	}
}

support_independence_action = {
	condition = {
		tooltip = EDG_TIM_CANT_DECLARE_WARS_DURING_SUCCESSION_CRISIS
		potential = {
			ai = yes
			FROM = {
				has_country_modifier = EDG_TIM_succession_crisis_modifier
			}
		}
		allow = { 
			tag = SHY
			FROM = {
				tag = KOK
			}
		}
	}
}

excommunicate_action = {
	condition = {
		tooltip = EDG_BAV_CAN_NOT_EXCOMMUNICATE_WITHIN_PRIVILEGE
		potential = { 
			FROM = {
				has_estate_privilege = estate_edg_artists_privilege_11
			}
		}
		allow = { 
			always = no
		}
	}
}
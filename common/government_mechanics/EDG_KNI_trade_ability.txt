EDG_KNI_trade_ability = {
	alert_icon_gfx = GFX_alerticons_government_mechanics
	alert_icon_index = 20
	available = {
		has_dlc = "Winds of Change"
	}

	powers = {
		EDG_KNI_trade_power = {
			gui = EDG_KNI_trade_influence_gov_mech 
			show_before_interactions = yes
			max = 100
			base_monthly_growth = 0.0
			is_good = yes
			scaled_modifier = {
				modifier = {
                    placed_merchant_power = 15
                    trade_efficiency = 0.2
				}
			}
			range_modifier = {
				trigger = {
					NOT = { trade_income_percentage = 0.25 }
				}
				modifier = {
					monthly_EDG_KNI_trade_power = -0.2
				}
			}
			range_modifier = {
				trigger = {
					dip = 6
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.25
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						dip = 6
					}
					dip = 5
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.2
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						dip = 5
					}
					dip = 4
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.15
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						dip = 3
					}
					dip = 2
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.1
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						dip = 2
					}
					dip = 1
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.05
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
						dip = 1
					}
					dip = 0
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
					  prestige  =40
					}
					prestige  =20		
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.05
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
					  prestige  =60
					}
					prestige  =40		
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.1
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
					  prestige  =80
					}
					prestige  =60		
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.15
				}
			}
			range_modifier = {
				trigger = {
					NOT = {
					  prestige  =100
					}
					prestige  =80		
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.20
				}
			}
			range_modifier = {
				trigger = {
					prestige  =100		
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.25
				}
			}
			range_modifier = {
				trigger = {
	              NOT = {
					religious_unity = 0.5
				  }
				}
				modifier = {
					monthly_EDG_KNI_trade_power = -0.1
				}
			}
			range_modifier = {
				trigger = {
					religious_unity = 1
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.1
				}
			}
			range_modifier = {
				trigger = {
					stability = 3
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.15
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = 3
					}
					stability = 2
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.1
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = 2
					}
					stability = 1
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0.05
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = 1
					}
					stability = 0
				}
				modifier = {
					monthly_EDG_KNI_trade_power = 0
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = 0
					}
					stability = -1
				}
				modifier = {
					monthly_EDG_KNI_trade_power = -0.05
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = -1
					}
					stability = -2
				}
				modifier = {
					monthly_EDG_KNI_trade_power = -0.10
				}
			}
			range_modifier = {
				trigger = {
					NOT={
					stability = -2
					}
					stability = -3
				}
				modifier = {
					monthly_EDG_KNI_trade_power = -0.15
				}
			}
		}
	}
	interactions = {
		EDG_KNI_T1 = {		
			icon = GFX_propogate_religion_interaction 
			cost_type = EDG_KNI_trade_power 
			cost = 15
			trigger = {
                
			}
			effect = {
                define_advisor = {
                    type = inquisitor
                    skill = 3
                    cost_multiplier = 0.25
                }
			}
			ai_chance = {
				factor = 0	
			}
            cooldown_years = 15
		}
		
		support_overseas_merchants_interaction = {		
			icon = GFX_support_overseas_merchants_interaction 
			cost_type = EDG_KNI_trade_power
			cost = 10
			trigger = {
	
			}
			effect = {
				custom_tooltip = ORM_GAIN_TRADE_POWER_IN_ALL_MERCHANT_NODES
				custom_tooltip = " "
				hidden_effect = {
					every_province = {
						limit = {
						  NOT = { has_province_flag = orm_trade_node_check }
						}
						if = {
							limit = {
								has_trader = ROOT
							}
							add_trade_modifier = {
								who = ROOT
								duration = 5475
								power = 50
								key = ORM_MERCHANT_PRESENCE
							}
						}
						every_trade_node_member_province = {
							set_province_flag = orm_trade_node_check
						}
					}
					every_province = {
						clr_province_flag = orm_trade_node_check
					}
				}
				custom_tooltip = " "
				define_advisor = {
					type = trader
					skill = 2
					cost_multiplier = 0.5
				}
				custom_tooltip = " "
				add_country_modifier = {
					name = orm_strengthened_merchant_influence
					duration = 5475
				}
			}
			ai_chance = {
				factor = 0	
			}
            cooldown_years = 15
		}
	
        strengthen_outposts_interaction = {		
			icon = GFX_strengthen_outposts_interaction 
			cost_type = EDG_KNI_trade_power
			cost = 15
			cooldown_years = 10
			trigger = {
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					value = 1
					province_has_center_of_trade_of_level = 2
				}
			}
			effect = {
				custom_tooltip = ORM_GRANT_OVERSEAS_COT_FOLLOWING_BONUS
				if = {
					limit = {
						has_dlc = "Dharma"
					}
					tooltip = {
						if = {
							limit = {
								has_country_flag = orm_trade_outposts_interaction_buff_flag
							}
							add_province_modifier = {
								name = orm_protected_trading_outposts_buffed
								duration = 3650
							}
						}
						else = {
							add_province_modifier = {
								name = orm_protected_trading_outposts
								duration = 3650
							}
						}
					}
				}
				else = {
					tooltip = {
						if = {
							limit = {
								has_country_flag = orm_trade_outposts_interaction_buff_flag
							}
							add_province_modifier = {
								name = orm_protected_trading_outposts_buffed_no_dlc
								duration = 3650
							}
						}
						else = {
							add_province_modifier = {
								name = orm_protected_trading_outposts_no_dlc
								duration = 3650
							}
						}
				}
				}
			}
		}
	}
}
estate_EDG_TIM_khiva_privilege = {
	icon = privilege_land_rights
	loyalty = 0
	influence = 0.2
	land_share = 0
	max_absolutism = -20
	cooldown_years = 20

	is_valid = {
		has_country_flag = EDG_TIM_grant_khiva_privilege_flag
		NOT = {
			has_country_flag = EDG_TIM_revoke_khiva_privilege_flag
		}
		KHI = {
			is_subject_of = PREV
		}
	}

	on_granted = {
		custom_tooltip = estate_EDG_TIM_khiva_privilege_tt
	}

	on_revoked = {
		set_country_flag = EDG_TIM_revoke_khiva_privilege_flag
	}

	benefits = {
		liberty_desire = -5
	}

	mechanics = {
		exempt_from_seize_land
	}

	ai_will_do = {
		factor = 0
	}
}

estate_EDG_TIM_yasa = {
	icon = privilege_aged_paper
	loyalty = 0.1
	influence = 0.2
	land_share = 0
	max_absolutism = -10
	cooldown_years = 10

	is_valid = {
		OR = {
			tag = TIM
			was_tag = TIM
		}
		NOT = {
			has_country_flag = EDG_TIM_strengthen_yasa_flag
		}
	}

	can_select = {
		NOT = {
			has_country_flag = EDG_TIM_ban_yasa_flag
		}
	}

	on_revoked = {
		random_owned_province = {
			limit = {
				culture_group = altaic
			}
			spawn_rebels = {
				type = tribal_rebels
				size = 2
			}
		}
		random_owned_province = {
			limit = {
				culture_group = altaic
			}
			spawn_rebels = {
				type = tribal_rebels
				size = 2
			}
		}
		random_owned_province = {
			limit = {
				culture_group = altaic
			}
			spawn_rebels = {
				type = tribal_rebels
				size = 2
			}
		}
	}

	benefits = {
		tolerance_heathen = 1
		army_tradition_decay = -0.01
		religious_unity = -0.15
		tolerance_own = -1
		church_loyalty_modifier = -0.1
	}

	ai_will_do = {
		factor = 0
		modifier = {
			factor = 10
			is_at_war = yes
		}
	}
}

estate_EDG_TIM_yasa_updated = {
	icon = privilege_aged_paper
	loyalty = 0.1
	influence = 0.2
	land_share = 0
	max_absolutism = -10

	is_valid = {
		OR = {
			tag = TIM
			was_tag = TIM
		}
		has_country_flag = EDG_TIM_strengthen_yasa_flag
	}

	can_revoke = {
		always = no
	}

	benefits = {
		amount_of_banners = 0.5
		tolerance_heathen = 1
		army_tradition_decay = -0.01
		tolerance_own = -1
		church_loyalty_modifier = -0.1
		EDG_TIM_turco_mongol_faction_influence = 0.1
		cavalry_cost = -0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_control_persian_gulf_trade = {
	icon = privilege_aged_paper
	loyalty = 0.1
	influence = 0.05
	land_share = 0
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_mission_persian_gulf_flag
	}

	can_select = {
		owns_or_non_sovereign_subject_of = 2999
	}

	benefits = {
		merchants = 1
		global_trade_power = 0.2
		burghers_privilege_slots = 1
		trade_efficiency = -0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_control_gujarat_trade = {
	icon = privilege_aged_paper
	loyalty = 0.1
	influence = 0.05
	land_share = 0
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_mission_gujarat_flag
	}

	can_select = {
		owns_or_non_sovereign_subject_of = 4457
	}

	benefits = {
		merchants = 1
		trade_steering = 0.2
		burghers_privilege_slots = 1
		trade_efficiency = -0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_control_aden_trade = {
	icon = privilege_aged_paper
	loyalty = 0.1
	influence = 0.05
	land_share = 0
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_mission_aden_flag
	}

	can_select = {
		owns_or_non_sovereign_subject_of = 388
	}

	benefits = {
		merchants = 1
		ship_trade_power_modifier = 0.5
		embargo_efficiency = 0.5
		burghers_privilege_slots = 1
		trade_efficiency = -0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_recruit_mamluks = {
	icon = qizlbash_cavalry
	loyalty = 0
	influence = 0.1
	land_share = 5
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_enable_mamluks_flag
	}

	can_select = {
		any_owned_province = {
			culture = al_misr_arabic
		}
		NOT = {
			has_estate_privilege = estate_EDG_TIM_recruit_mamluks_ghulam
		}
	}

	on_revoked = {
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
	}

	benefits = {
		has_mamluks = yes
		nobles_privilege_slots = 1
		amount_of_mamluks = 10
		allowed_mamluks_fraction = 0.1
		cavalry_power = 0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_recruit_mamluks_ghulam = {
	icon = qizlbash_cavalry
	loyalty = 0
	influence = 0.1
	land_share = 5
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_enable_mamluks_flag
	}

	can_select = {
		any_owned_province = {
			culture = al_misr_arabic
		}
		NOT = {
			has_estate_privilege = estate_EDG_TIM_recruit_mamluks
		}
	}

	on_revoked = {
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
		random_owned_province = {
			limit = {
				culture = al_misr_arabic
			}
			spawn_rebels = {
				type = noble_rebels
				size = 3
			}
		}
	}

	benefits = {
		has_mamluks = yes
		ghulams_privilege_slots = 1
		amount_of_mamluks = 10
		allowed_mamluks_fraction = 0.1
		cavalry_power = 0.1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_dryland_people = {
	icon = privilege_dev_cost_desert
	land_share = 0
	max_absolutism = -5
	loyalty = 0.05
	influence = 0.1

	is_valid = {
		has_country_flag = EDG_TIM_mission_urbanization_flag
	}

	on_granted = {
		custom_tooltip = estate_EDG_TIM_dryland_people_tt_1
		custom_tooltip = estate_EDG_TIM_dryland_people_tt_3
		tooltip = {
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_dryland_modifier
				duration = -1
			}
		}
		custom_tooltip = estate_EDG_TIM_dryland_people_tt_4
		tooltip = {
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_desert_modifier
				duration = -1
			}
		}
		custom_tooltip = estate_EDG_TIM_dryland_people_tt_5
		tooltip = {
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_arid_modifier
				duration = -1
			}
		}
	}

	on_granted_province = {
		if = {
			limit = {
				has_terrain = drylands
				OR = {
					region = central_asia_region
					region = persia_region
					region = khorasan_region
				}
			}
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_dryland_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = desert
				OR = {
					region = central_asia_region
					region = persia_region
					region = khorasan_region
				}
			}
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_desert_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_climate = arid
				OR = {
					region = central_asia_region
					region = persia_region
					region = khorasan_region
				}
			}
			add_province_modifier = {
				name = EDG_TIM_dryland_people_for_arid_modifier
				duration = -1
			}
		}
	}

	on_revoked = {
		custom_tooltip = estate_EDG_TIM_dryland_people_tt_2
	}

	on_revoked_province = {
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_dryland_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_dryland_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_desert_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_desert_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_arid_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_arid_modifier
		}
	}

	on_invalid_province = {
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_dryland_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_dryland_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_desert_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_desert_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_dryland_people_for_arid_modifier }
			remove_province_modifier = EDG_TIM_dryland_people_for_arid_modifier
		}
	}

	benefits = {
		burghers_privilege_slots = 1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_hill_people = {
	icon = privilege_dev_cost_mountain
	land_share = 0
	max_absolutism = -5
	loyalty = 0.05
	influence = 0.1

	is_valid = {
		has_country_flag = EDG_TIM_mission_khorasan_renaissance_flag
	}

	on_granted = {
		custom_tooltip = estate_EDG_TIM_hill_people_tt_1
		custom_tooltip = estate_EDG_TIM_hill_people_tt_3
		tooltip = {
			add_province_modifier = {
				name = EDG_TIM_hill_people_for_highland_modifier
				duration = -1
			}
		}
		custom_tooltip = estate_EDG_TIM_hill_people_tt_4
		tooltip = {
			add_province_modifier = {
				name = EDG_TIM_hill_people_for_mountain_modifier
				duration = -1
			}
		}
	}

	on_granted_province = {
		if = {
			limit = {
				has_terrain = highlands
				OR = {
					region = central_asia_region
					region = persia_region
					region = khorasan_region
				}
			}
			add_province_modifier = {
				name = EDG_TIM_hill_people_for_highland_modifier
				duration = -1
			}
		}
		if = {
			limit = {
				has_terrain = mountain
				OR = {
					region = central_asia_region
					region = persia_region
					region = khorasan_region
				}
			}
			add_province_modifier = {
				name = EDG_TIM_hill_people_for_mountain_modifier
				duration = -1
			}
		}
	}

	on_revoked = {
		custom_tooltip = estate_EDG_TIM_hill_people_tt_2
	}

	on_revoked_province = {
		if = {
			limit = { has_province_modifier = EDG_TIM_hill_people_for_highland_modifier }
			remove_province_modifier = EDG_TIM_hill_people_for_highland_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_hill_people_for_mountain_modifier }
			remove_province_modifier = EDG_TIM_hill_people_for_mountain_modifier
		}
	}

	on_invalid_province = {
		if = {
			limit = { has_province_modifier = EDG_TIM_hill_people_for_highland_modifier }
			remove_province_modifier = EDG_TIM_hill_people_for_highland_modifier
		}
		if = {
			limit = { has_province_modifier = EDG_TIM_hill_people_for_mountain_modifier }
			remove_province_modifier = EDG_TIM_hill_people_for_mountain_modifier
		}
	}

	benefits = {
		burghers_privilege_slots = 1
	}

	ai_will_do = {
		factor = 10
	}
}

estate_EDG_TIM_chaghatai_warriors = {
	icon = privilege_raise_host
	loyalty = 0
	influence = 0.1
	land_share = 0
	max_absolutism = -10

	is_valid = {
		has_country_flag = EDG_TIM_mission_chagatai_warriors_flag
	}

	benefits = {
		has_banners = yes
		nomadic_tribes_privilege_slots = 1
		global_manpower_modifier = 0.1
	}
	
	# loyalty_scaled_conditional_modifier = {
	# 	trigger = {
	# 		always = yes
	# 	}
	# 	modifier = {
	# 		discipline = 0.2
	# 		is_banner_modifier = yes
	# 	}
	# }

	on_granted = {
		custom_tooltip = estate_EDG_TIM_chaghatai_warriors_tt
		hidden_effect = {
			capital_scope = {
				add_province_modifier = {
					name = EDG_TIM_kheshig_capital_modifier
					duration = -1
					hidden = yes
				}
			}
			every_owned_province = {
				limit = { culture_group = altaic }
				add_province_modifier = {
					name = EDG_TIM_kheshig_modifier
					duration = -1
					hidden = yes
				}
			}
		}
		add_country_modifier = {
			name = EDG_TIM_chaghatai_warriors_modifier
			duration = -1
		}
	}

	on_revoked = {
		remove_country_modifier = EDG_TIM_chaghatai_warriors_modifier
		hidden_effect = {
			capital_scope = { remove_province_modifier = EDG_TIM_kheshig_capital_modifier }
			every_owned_province = {
				limit = { has_province_modifier = EDG_TIM_kheshig_modifier }
				remove_province_modifier = EDG_TIM_kheshig_modifier
			}
		}
	}

	ai_will_do = {
		factor = 100
	}
}

estate_EDG_TIM_convergence_of_islam_and_confucianism = {
	icon = estate_eunuchs_establish_favor_system_privilege
	loyalty = -0.05
	influence = -0.05
	land_share = 0
	max_absolutism = 0

	is_valid = {
		has_country_flag = EDG_TIM_enable_convergence_of_islam_and_confucianism_flag
	}

	benefits = {
		church_privilege_slots = 1
		tolerance_heathen = 2
		religious_unity = 0.1
		imperial_mandate = 0.05
		meritocracy = 1
		idea_cost = -0.1
	}

	on_granted = {
		custom_tooltip = estate_EDG_TIM_convergence_of_islam_and_confucianism_tt
		hidden_effect = {
			every_owned_province = {
				limit = { religion = confucianism }
				add_province_modifier = {
					name = EDG_TIM_convergence_of_islam_and_confucianism_modifier
					duration = -1
				}
			}
		}
	}

	on_revoked = {
		hidden_effect = {
			every_owned_province = {
				limit = { has_province_modifier = EDG_TIM_convergence_of_islam_and_confucianism_modifier }
				remove_province_modifier = EDG_TIM_convergence_of_islam_and_confucianism_modifier
			}
		}
	}

	ai_will_do = {
		factor = 100
	}
}

estate_EDG_TIM_ghulam_elites = {
	icon = privilege_recruit_rajput_general
	loyalty = 0.1
	influence = 0.1
	land_share = 0
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_mission_PER_ghulams_flag
	}

	benefits = {
		has_mamluks = yes
		ghulams_privilege_slots = 1
		amount_of_mamluks = 10
		allowed_mamluks_fraction = 0.25
	}

	# loyalty_scaled_conditional_modifier = {
	# 	trigger = {
	# 		always = yes
	# 	}
	# 	modifier = {
	# 		discipline = 0.2
	# 	}
	# }

	# influence_scaled_conditional_modifier = {
	# 	trigger = {
	# 		has_country_flag = EDG_TIM_mission_PER_qurchi_flag
	# 	}
	# 	modifier = {
	# 		shock_damage_received = -0.1
	# 		fire_damage_received = -0.1
	# 		is_mamluks_modifier = yes
	# 	}
	# }

	# influence_scaled_conditional_modifier = {
	# 	trigger = {
	# 		has_country_flag = EDG_TIM_mission_PER_tupchi_flag
	# 	}
	# 	modifier = {
	# 		fire_damage = 0.2
	# 		is_mamluks_modifier = yes
	# 	}
	# }

	on_granted = {
		hidden_effect = {
			EDG_TIM_refresh_ghulam_dynamic_buff_effect = yes
		}

		custom_tooltip = estate_EDG_TIM_ghulam_elites_loyalty_tt
		if = {
			limit = {
				has_country_flag = EDG_TIM_mission_PER_tupchi_flag
				has_country_flag = EDG_TIM_mission_PER_qurchi_flag
			}
			custom_tooltip = estate_EDG_TIM_ghulam_elites_tupchi_qurchi_tt
		}
		else_if = {
			limit = {
				has_country_flag = EDG_TIM_mission_PER_tupchi_flag
			}
			custom_tooltip = estate_EDG_TIM_ghulam_elites_tupchi_tt
		}
		else_if = {
			limit = {
				has_country_flag = EDG_TIM_mission_PER_qurchi_flag
			}
			custom_tooltip = estate_EDG_TIM_ghulam_elites_qurchi_tt
		}

		custom_tooltip = estate_EDG_TIM_ghulam_elites_tt1
		custom_tooltip = estate_action_potential_effect
		custom_tooltip = estate_EDG_TIM_ghulam_elites_tt2
		tooltip = {
			change_variable = {
				which = EDG_PER_Shahanshah_authority_var
				value = -100
			}
			mil_power_cost = 200
		}
		custom_tooltip = estate_EDG_TIM_ghulam_elites_tt3
	}

	on_revoked = {
		hidden_effect = {
			EDG_TIM_remove_all_ghulam_dynamic_buffs_effect = yes
		}
	}

	ai_will_do = {
		factor = 100
	}
}

estate_EDG_TIM_ghulam_officials = {
	icon = privilege_recruit_rajput_general
	loyalty = 0.1
	influence = 0.1
	land_share = 0
	max_absolutism = -5

	is_valid = {
		has_country_flag = EDG_TIM_mission_PER_ghulams_flag
	}

	benefits = {
		ghulams_privilege_slots = 1
		drill_gain_modifier = 0.5
		leader_land_shock = 1
		leader_land_fire = 1
	}

	# influence_scaled_conditional_modifier = {
	# 	trigger = {
	# 		always = yes
	# 	}
	# 	modifier = {
	# 		morale_damage_received = -0.1
	# 		is_mamluks_modifier = yes
	# 	}
	# }

	on_granted = {
		custom_tooltip = estate_EDG_TIM_ghulam_officials_tt
		add_country_modifier = {
			name = EDG_TIM_ghulam_officials_modifier
			duration = -1
		}
	}

	on_revoked = {
		remove_country_modifier = EDG_TIM_ghulam_officials_modifier
	}

	ai_will_do = {
		factor = 100
	}
}


on_startup = {
	if = {
		limit = {
			tag = SHY
		}
		country_event = {
			id = EDG_SHYEvents.4
			days = 1
		}
	}
	if = {
		limit = {
			mission_completed = EDG_SHY_mission_1_4
			NOT = {
				has_country_flag = EDG_SHY_enable_get_ship_flag
			}
		}
		set_country_flag = EDG_SHY_enable_get_ship_flag
	}
}

on_monarch_death = {
	events = {
		EDG_SHYEvents.5
	}
}
on_new_monarch = {
	events = {
		EDG_SHYEvents.15
	}
}

on_main_war_won = {
	if = {
		limit = {
			OR = {
				tag = SHY
				was_tag = SHY
			}
			from = {
				technology_group = muslim
			}
		}
		change_variable = {
			which = EDG_SHY_main_war_win_count
			value = 1
		}
	}
}

on_raze = {
	if = {
		limit = {
			has_fort_building_trigger = yes
			owner = {
				has_country_flag = EDG_SHY_enable_remove_building_fort_flag
			}
		}
		remove_building = fort_15th
		remove_building = fort_16th
		remove_building = fort_17th
		remove_building = fort_18th
		owner = {
			add_treasury = 100
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = EDG_SHY_enable_more_gold_of_temple_flag
			}
		}
		if = {
			limit = {
				has_building = temple
			}
			owner = {
				add_treasury = 10
			}
		}
		else_if = {
			limit = {
				has_building = cathedral
			}
			owner = {
				add_treasury = 20
			}
		}
	}
	if = {
		limit = {
			owner = {
				has_country_flag = EDG_SHY_enable_raze_get_core_flag
			}
		}
		add_territorial_core = owner
	}
}

on_barrage = {
	#ROOT - barraging country, FROM - barraged province 
	if = {
		limit = {
			root = {
				has_country_flag = EDG_SHY_enable_barrage_speed_up_siege_flag
			}
		}
		from = {
			change_siege = 10
		}
	}
}

on_battle_lost_unit = {
	if = {
		limit = {
			unit_owner = {
				OR = {
					tag = SHY
					was_tag = SHY
				}
				has_ruler_flag = EDG_SHY_Sibanihan_flag
			}
			is_ruler_commanding_unit = yes
			enemy_unit = {
				unit_owner = {
					OR = {
						tag = ARL
						tag = PER
					}
					has_ruler_flag = EDG_ARL_Isma_ruler_flag
				}
				is_ruler_commanding_unit = yes
			}
		}
		country_event = {
			id = EDG_SHYEvents.10
		}
	}
}
on_yearly_pulse = {
	if = {
		limit = {
			ai = yes
			is_at_war = no
			has_country_modifier = EDG_SHY_great_expedition
		}
		every_owned_province = {
			limit = {
				NOT = {
					is_core = root
				}
				NOT = {
					has_province_modifier = province_razed
				}
			}
			EDG_auto_raze_province = {
				remove_loot = yes	
				raze = yes			
				core = yes			
			}
		}
		random_neighbor_country = {
			limit = {
				NOT = {
					truce_with = root
				}
				is_subject = no
			}
			root = {
				declare_war_with_cb = {
					casus_belli = cb_annex
					who = prev
				}
				if = {
					limit = {
						NOT = {
							manpower_percentage = 0.9
						}
					}
					add_manpower = 25
					add_yearly_manpower = 5
				}
				else = {
					add_manpower = 10
				}
			}
		}
	}
}
on_monthly_pulse = {
	if = {
		limit = {
			ai = yes
			is_at_war = no
			has_country_modifier = EDG_SHY_great_expedition
			NOT = {
				has_country_modifier = EDG_SHY_war_preparation
			}
		}
		add_country_modifier = {
			name = EDG_SHY_war_preparation
			duration = 1825
		}
		every_owned_province = {
			limit = {
				NOT = {
					is_core = root
				}
				NOT = {
					has_province_modifier = province_razed
				}
			}
			EDG_auto_raze_province = {
				remove_loot = yes	
				raze = yes			
				core = yes			
			}
		}
		random_neighbor_country = {
			limit = {
				NOT = {
					truce_with = root
				}
				is_subject = no
			}
			root = {
				declare_war_with_cb = {
					casus_belli = cb_annex
					who = prev
				}
				if = {
					limit = {
						NOT = {
							manpower_percentage = 0.9
						}
					}
					add_manpower = 25
					add_yearly_manpower = 5
				}
				else = {
					add_manpower = 10
				}
			}
		}
	}
}